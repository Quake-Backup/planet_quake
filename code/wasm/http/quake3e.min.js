"undefined"!=typeof global&&void 0===global.window&&(global.window={});var Q3e={};function getQueryCommands(){let e=["quake3e_web","+set","developer","0","+set","fs_basepath","/base","+set","fs_homepath","/home","+set","sv_pure","0","+set","fs_basegame","multigame","+set","r_mode","-1","+set","r_ext_framebuffer_object","0","+set","bot_enable","0","+set","net_socksServer",window.location.hostname||"","+set","net_socksPort",window.location.port||"0","+set","sv_fps","100","+set","snaps","100"];for(var t=/([^&=]+)/g,n=window.location.search.substring(1);r=t.exec(n);){var r=decodeURIComponent(r[1]);(r=r.split(" "))[0]=("+"!=r[0][0]?"+":"")+r[0],e.push.apply(e,r)}return e.push.apply(e,window.preStart),e.unshift.apply(e,["+set","r_fullscreen",window.fullscreen?"1":"0","+set","r_customHeight",""+window.innerHeight||0,"+set","r_customWidth",""+window.innerWidth||0]),e}function addressToString(t,n){let r="";if(!t)return r;n=n||1024;for(let e=0;e<n&&0!=HEAPU8[t+e];e++)r+=String.fromCharCode(HEAPU8[t+e]);return r}function stringToAddress(t,e){let n=Q3e.sharedMemory+Q3e.sharedCounter;"string"!=typeof t&&(t+=""),e&&(n=e);for(let e=0;e<t.length;e++)HEAPU8[n+e]=t.charCodeAt(e);return HEAPU8[n+t.length]=0,HEAPU8[n+t.length+1]=0,HEAPU8[n+t.length+2]=0,e||(Q3e.sharedCounter+=t.length+3,Q3e.sharedCounter+=4-Q3e.sharedCounter%4,524288<Q3e.sharedCounter&&(Q3e.sharedCounter=0)),n}function stringsToMemory(t,e){var n=Q3e.sharedMemory+Q3e.sharedCounter;let r=n+4*t.length;for(let e=0;e<t.length;e++)HEAPU32[n+4*e>>2]=r,stringToAddress(t[e],r),r+=t[e].length+1;return e&&(HEAPU32[e>>2]=r-n),Q3e.sharedCounter=r-Q3e.sharedMemory,Q3e.sharedCounter+=4-Q3e.sharedCounter%4,524288<Q3e.sharedCounter&&(Q3e.sharedCounter=0),n}function Sys_UnloadLibrary(){}function Sys_LoadLibrary(){}function Sys_LoadFunction(){}function Sys_Microseconds(){return window.performance.now?parseInt(window.performance.now(),10):window.performance.webkitNow?parseInt(window.performance.webkitNow(),10):(Q3e.sharedCounter+=8,Q3e.sharedMemory+Q3e.sharedCounter-8)}function Sys_Milliseconds(){return Q3e.timeBase||(Q3e.timeBase=Date.now()-5e3),Date.now()-Q3e.timeBase}function Sys_RandomBytes(t,n){if("undefined"!=typeof crypto)crypto.getRandomValues(HEAP8.subarray(t,t+n/4));else for(let e=0;e<n/4;e++)HEAP8[t]=255*Math.random();return!0}function Sys_Print(e){console.log(addressToString(e))}function Sys_Exit(e){Q3e.exited=!0,GLimp_Shutdown(),NET_Shutdown(),Q3e.frameInterval&&(clearInterval(Q3e.frameInterval),Q3e.frameInterval=null);var t=addressToString(Cvar_VariableString("cl_returnURL"));t&&(window.location=t)}function Sys_Error(e,t){throw 0<BG_sprintf(Q3e.sharedMemory+Q3e.sharedCounter,e,t)&&console.log("Sys_Error: ",addressToString(Q3e.sharedMemory+Q3e.sharedCounter)),Sys_Exit(1),new Error(addressToString(e))}function Sys_SetStatus(e,t){}function CL_MenuModified(e,t,n){if(!INPUT.modifyingCrumb&&null!=window.location.orgin){let e=addressToString(t);t=e.replace(/[^a-z0-9]/gi,"");Q3e.initialized||(Q3e.initialized=!0,document.body.className+=" done-loading "),window.location.pathname.toString().includes(t)||history.pushState({location:window.location.pathname},"Quake III Arena: "+e,t)}}function CL_ModifyMenu(e){var t=window.location.pathname.toString().substring(1)||"MAIN MENU";Cbuf_AddText(stringToAddress(`set ui_breadCrumb "${t}"
`))}function Sys_Frame(){requestAnimationFrame(function(){Q3e.running=!Q3e.running;try{Com_Frame(Q3e.running)}catch(e){if(console.log(e),!Q3e.exited||"unreachable"!=e.message)throw Sys_Exit(1),e}})}function alignUp(e,t){return 0<e%t&&(e+=t-e%t),e}function updateGlobalBufferAndViews(e){Q3e.HEAP8=window.HEAP8=new Int8Array(e),Q3e.HEAPU8=window.HEAPU8=new Uint8Array(e),Q3e.HEAP16=window.HEAP16=new Int16Array(e),Q3e.HEAPU16=window.HEAPU16=new Uint16Array(e),Q3e.HEAP32=window.HEAP32=new Int32Array(e),Q3e.HEAPU32=window.HEAPU32=new Uint32Array(e),Q3e.HEAPF32=window.HEAPF32=new Float32Array(e),Q3e.HEAPF64=window.HEAPF64=new Float64Array(e)}function emscripten_realloc_buffer(t){try{return Q3e.memory.grow(t-Q3e.memory.buffer.byteLength+65535>>>16),updateGlobalBufferAndViews(Q3e.memory.buffer),1}catch(e){console.error("emscripten_realloc_buffer: Attempted to grow heap from "+Q3e.memory.buffer.byteLength+" bytes to "+t+" bytes, but got error: "+e)}}function _emscripten_resize_heap(e){var t=HEAPU8.length,n=(e>>>=0,console.assert(t<e),2147483648);if(n<e)return err("Cannot enlarge memory, asked to go up to "+e+" bytes, but the limit is "+n+" bytes!"),!1;for(var r=1;r<=4;r*=2){var o=t*(1+.2/r),o=Math.min(o,e+100663296),i=Math.min(n,alignUp(Math.max(e,o),65536)),o=Sys_Milliseconds(),s=emscripten_realloc_buffer(i),a=Sys_Milliseconds();if(console.log("Heap resize call from "+t+" to "+i+" took "+(a-o)+" msecs. Success: "+!!s),s)return!0}return err("Failed to grow the heap from "+t+" bytes to "+i+" bytes, not enough memory!"),!1}function _emscripten_get_heap_size(){return HEAPU8.length}window.Q3e=Q3e;var SYS={DebugBreak:function(){},DebugTrace:function(){console.log(new Error)},emscripten_resize_heap:_emscripten_resize_heap,emscripten_get_heap_size:_emscripten_get_heap_size,Sys_RandomBytes:Sys_RandomBytes,Sys_Milliseconds:Sys_Milliseconds,Sys_Microseconds:Sys_Microseconds,Sys_Exit:Sys_Exit,Sys_Frame:Sys_Frame,Sys_Error:Sys_Error,Sys_UnloadLibrary:Sys_UnloadLibrary,Sys_LoadLibrary:Sys_LoadLibrary,Sys_LoadFunction:Sys_LoadFunction,popen:function(){},Sys_Print:Sys_Print,Sys_SetStatus:Sys_SetStatus,CL_MenuModified:CL_MenuModified};function __webgl_enable_WEBGL_draw_instanced_base_vertex_base_instance(e){return!!(e.dibvbi=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"))}function __webgl_enable_WEBGL_multi_draw_instanced_base_vertex_base_instance(e){return!!(e.mdibvbi=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"))}function __webgl_enable_WEBGL_multi_draw(e){return!!(e.multiDrawWebgl=e.getExtension("WEBGL_multi_draw"))}function SAFE_HEAP_STORE(e,t,n,r){switch(n){case 1:HEAP8[e>>0]=t;break;case 2:HEAP16[e>>1]=t;break;case 4:r?HEAPF32[e>>2]=t:HEAP32[e>>2]=t;break;case 8:HEAPF64[e>>3]=t;break;default:throw new Error("data type not supported "+n)}return t}function unSign(e,t){return 0<=e?e:t<=32?2*Math.abs(1<<t-1)+e:Math.pow(2,t)+e}function SAFE_HEAP_LOAD(e,t,n,r){let o;switch(t){case 1:o=HEAP8[e>>0];break;case 2:o=HEAP16[e>>1];break;case 4:o=(r?HEAPF32:HEAP32)[e>>2];break;case 8:o=HEAPF64[e>>3];break;default:throw new Error("data type not supported "+t)}return o=n?unSign(o,8*t):o}var GL={counter:1,buffers:[],mappedBuffers:{},programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:[],offscreenCanvases:{},queries:[],samplers:[],transformFeedbacks:[],syncs:[],byteSizeByTypeRoot:5120,byteSizeByType:[1,1,2,2,4,4,4,2,3,4,8],stringCache:{},stringiCache:{},unpackAlignment:4,recordError:function(e){GL.lastError||(GL.lastError=e)},getNewId:function(e){for(var t=GL.counter++,n=e.length;n<t;n++)e[n]=null;return t},MAX_TEMP_BUFFER_SIZE:2097152,numTempVertexBuffersPerSize:64,log2ceilLookup:function(e){return 32-Math.clz32(0===e?0:e-1)},generateTempBuffers:function(e,t){var n=GL.log2ceilLookup(GL.MAX_TEMP_BUFFER_SIZE);t.tempVertexBufferCounters1=[],t.tempVertexBufferCounters2=[],t.tempVertexBufferCounters1.length=t.tempVertexBufferCounters2.length=n+1,t.tempVertexBuffers1=[],t.tempVertexBuffers2=[],t.tempVertexBuffers1.length=t.tempVertexBuffers2.length=n+1,t.tempIndexBuffers=[],t.tempIndexBuffers.length=n+1;for(var r=0;r<=n;++r){t.tempIndexBuffers[r]=null,t.tempVertexBufferCounters1[r]=t.tempVertexBufferCounters2[r]=0;var o=GL.numTempVertexBuffersPerSize,i=(t.tempVertexBuffers1[r]=[],t.tempVertexBuffers2[r]=[],t.tempVertexBuffers1[r]),s=t.tempVertexBuffers2[r];i.length=s.length=o;for(var a=0;a<o;++a)i[a]=s[a]=null}if(e){t.tempQuadIndexBuffer=GLctx.createBuffer(),t.GLctx.bindBuffer(34963,t.tempQuadIndexBuffer);for(var l=GL.MAX_TEMP_BUFFER_SIZE>>1,c=new Uint16Array(l),r=0,u=0;;){if(c[r++]=u,l<=r)break;if(c[r++]=u+1,l<=r)break;if(c[r++]=u+2,l<=r)break;if(c[r++]=u,l<=r)break;if(c[r++]=u+2,l<=r)break;if(c[r++]=u+3,l<=r)break;u+=4}t.GLctx.bufferData(34963,c,35044),t.GLctx.bindBuffer(34963,null)}},getTempVertexBuffer:function(e){var e=GL.log2ceilLookup(e),t=GL.currentContext.tempVertexBuffers1[e],n=GL.currentContext.tempVertexBufferCounters1[e],r=(GL.currentContext.tempVertexBufferCounters1[e]=GL.currentContext.tempVertexBufferCounters1[e]+1&GL.numTempVertexBuffersPerSize-1,t[n]);if(r)return r;r=GLctx.getParameter(34964);return t[n]=GLctx.createBuffer(),GLctx.bindBuffer(34962,t[n]),GLctx.bufferData(34962,1<<e,35048),GLctx.bindBuffer(34962,r),t[n]},getTempIndexBuffer:function(e){var e=GL.log2ceilLookup(e),t=GL.currentContext.tempIndexBuffers[e];if(t)return t;t=GLctx.getParameter(34965);return GL.currentContext.tempIndexBuffers[e]=GLctx.createBuffer(),GLctx.bindBuffer(34963,GL.currentContext.tempIndexBuffers[e]),GLctx.bufferData(34963,1<<e,35048),GLctx.bindBuffer(34963,t),GL.currentContext.tempIndexBuffers[e]},newRenderingFrameStarted:function(){if(GL.currentContext)for(var e=GL.currentContext.tempVertexBuffers1,t=(GL.currentContext.tempVertexBuffers1=GL.currentContext.tempVertexBuffers2,GL.currentContext.tempVertexBuffers2=e,e=GL.currentContext.tempVertexBufferCounters1,GL.currentContext.tempVertexBufferCounters1=GL.currentContext.tempVertexBufferCounters2,GL.currentContext.tempVertexBufferCounters2=e,GL.log2ceilLookup(GL.MAX_TEMP_BUFFER_SIZE)),n=0;n<=t;++n)GL.currentContext.tempVertexBufferCounters1[n]=0},getSource:function(e,t,n,r){for(var o="",i=0;i<t;++i){var s=r?0|SAFE_HEAP_LOAD(r+4*i|0,4,0):-1;o+=addressToString(0|SAFE_HEAP_LOAD(n+4*i|0,4,0),s<0?void 0:s)}return o},calcBufLength:function(e,t,n,r){return 0<n?r*n:e*GL.byteSizeByType[t-GL.byteSizeByTypeRoot]*r},usedTempBuffers:[],preDrawHandleClientVertexAttribBindings:function(e){GL.resetBufferBinding=!1;for(var t=0;t<GL.currentContext.maxVertexAttribs;++t){var n,r,o=GL.currentContext.clientBuffers[t];o.clientside&&o.enabled&&(GL.resetBufferBinding=!0,n=GL.calcBufLength(o.size,o.type,o.stride,e),r=GL.getTempVertexBuffer(n),GLctx.bindBuffer(34962,r),GLctx.bufferSubData(34962,0,HEAPU8.subarray(o.ptr,o.ptr+n)),o.vertexAttribPointerAdaptor.call(GLctx,t,o.size,o.type,o.normalized,o.stride,0))}},postDrawHandleClientVertexAttribBindings:function(){GL.resetBufferBinding&&GLctx.bindBuffer(34962,GL.buffers[GLctx.currentArrayBufferBinding])},createContext:function(n,e){n.getContextSafariWebGL2Fixed||(n.getContextSafariWebGL2Fixed=n.getContext,n.getContext=function(e,t){t=n.getContextSafariWebGL2Fixed(e,t);return"webgl"==e==t instanceof WebGLRenderingContext?t:null});var t=n.getContext("webgl2",e);return t?GL.registerContext(t,e):0},registerContext:function(e,t){var n=GL.getNewId(GL.contexts),r={handle:n,attributes:t,version:t.majorVersion,GLctx:e};e.canvas&&(e.canvas.GLctxObject=r),GL.contexts[n]=r,void 0!==t.enableExtensionsByDefault&&!t.enableExtensionsByDefault||GL.initExtensions(r),r.maxVertexAttribs=r.GLctx.getParameter(34921),r.clientBuffers=[];for(var o=0;o<r.maxVertexAttribs;o++)r.clientBuffers[o]={enabled:!1,clientside:!1,size:0,type:0,normalized:0,stride:0,ptr:0,vertexAttribPointerAdaptor:null};return GL.generateTempBuffers(!1,r),n},makeContextCurrent:function(e){return GL.currentContext=GL.contexts[e],window.ctx=GLctx=GL.currentContext&&GL.currentContext.GLctx,!(e&&!GLctx)},getContext:function(e){return GL.contexts[e]},deleteContext:function(e){GL.currentContext===GL.contexts[e]&&(GL.currentContext=null),"object"==typeof JSEvents&&JSEvents.removeAllHandlersOnTarget(GL.contexts[e].GLctx.canvas),GL.contexts[e]&&GL.contexts[e].GLctx.canvas&&(GL.contexts[e].GLctx.canvas.GLctxObject=void 0),GL.contexts[e]=null},initExtensions:function(e){var t;(e=e||GL.currentContext).initExtensionsDone||(e.initExtensionsDone=!0,__webgl_enable_WEBGL_draw_instanced_base_vertex_base_instance(t=e.GLctx),__webgl_enable_WEBGL_multi_draw_instanced_base_vertex_base_instance(t),2<=e.version&&(t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query_webgl2")),(e.version<2||!t.disjointTimerQueryExt)&&(t.disjointTimerQueryExt=t.getExtension("EXT_disjoint_timer_query")),__webgl_enable_WEBGL_multi_draw(t),(t.getSupportedExtensions()||[]).forEach(function(e){e.includes("lose_context")||e.includes("debug")||t.getExtension(e)}))}};function _getTempRet0(){return getTempRet0()}function _glActiveTexture(e){GLctx.activeTexture(e)}function _glAlphaFunc(){}function _glArrayElement(){}function _glAttachShader(e,t){GLctx.attachShader(GL.programs[e],GL.shaders[t])}function _glBegin(){throw"Legacy GL function (glBegin) called. If you want legacy GL emulation, you need to compile with -s LEGACY_GL_EMULATION=1 to enable legacy GL emulation."}function _glBindAttribLocation(e,t,n){GLctx.bindAttribLocation(GL.programs[e],t,addressToString(n))}function _glBindBuffer(e,t){34962==e?GLctx.currentArrayBufferBinding=t:34963==e&&(GLctx.currentElementArrayBufferBinding=t),35051==e?GLctx.currentPixelPackBufferBinding=t:35052==e&&(GLctx.currentPixelUnpackBufferBinding=t),GLctx.bindBuffer(e,GL.buffers[t])}function _glBindFramebuffer(e,t){GLctx.bindFramebuffer(e,GL.framebuffers[t])}function _glBindRenderbuffer(e,t){GLctx.bindRenderbuffer(e,GL.renderbuffers[t])}function _glBindTexture(e,t){GLctx.bindTexture(e,GL.textures[t]),EMGL.previousTex=t,void 0!==EMGL.texFiles[t]?EMGL.previousImage=EMGL.texFiles[t][1]:EMGL.previousImage=null}function _glBindVertexArray(e){GLctx.bindVertexArray(GL.vaos[e]);e=GLctx.getParameter(34965);GLctx.currentElementArrayBufferBinding=e?0|e.name:0}function _glBlendFunc(e,t){GLctx.blendFunc(e,t)}function _glBlitFramebuffer(e,t,n,r,o,i,s,a,l,c){GLctx.blitFramebuffer(e,t,n,r,o,i,s,a,l,c)}function _glBufferData(e,t,n,r){n?GLctx.bufferData(e,HEAPU8,r,n,t):GLctx.bufferData(e,t,r)}function _glBufferSubData(e,t,n,r){GLctx.bufferSubData(e,t,HEAPU8,r,n)}function _glCheckFramebufferStatus(e){return GLctx.checkFramebufferStatus(e)}function _glClear(e){GLctx.clear(e)}function _glClearColor(e,t,n,r){GLctx.clearColor(e,t,n,r)}function _glClearDepth(e){GLctx.clearDepth(e)}function _glClearStencil(e){GLctx.clearStencil(e)}function _glClipPlane(){}function _glColor3f(){}function _glColor4f(){}function _glColor4ubv(){}function _glColorMask(e,t,n,r){GLctx.colorMask(!!e,!!t,!!n,!!r)}function _glColorPointer(){}function _glCompileShader(e){GLctx.compileShader(GL.shaders[e])}function _glCompressedTexImage2D(e,t,n,r,o,i,s,a){GLctx.currentPixelUnpackBufferBinding?GLctx.compressedTexImage2D(e,t,n,r,o,i,s,a):GLctx.compressedTexImage2D(e,t,n,r,o,i,HEAPU8,a,s)}function _glCompressedTexSubImage2D(e,t,n,r,o,i,s,a,l){GLctx.currentPixelUnpackBufferBinding?GLctx.compressedTexSubImage2D(e,t,n,r,o,i,s,a,l):GLctx.compressedTexSubImage2D(e,t,n,r,o,i,s,HEAPU8,l,a)}function _glCopyTexSubImage2D(e,t,n,r,o,i,s,a){GLctx.copyTexSubImage2D(e,t,n,r,o,i,s,a)}function _glCreateProgram(){var e=GL.getNewId(GL.programs),t=GLctx.createProgram();return t.name=e,t.maxUniformLength=t.maxAttributeLength=t.maxUniformBlockNameLength=0,t.uniformIdCounter=1,GL.programs[e]=t,e}function _glCreateShader(e){var t=GL.getNewId(GL.shaders);return GL.shaders[t]=GLctx.createShader(e),t}function _glCullFace(e){GLctx.cullFace(e)}function _glDeleteBuffers(e,t){for(var n=0;n<e;n++){var r=0|SAFE_HEAP_LOAD(t+4*n|0,4,0),o=GL.buffers[r];o&&(GLctx.deleteBuffer(o),o.name=0,GL.buffers[r]=null,r==GLctx.currentArrayBufferBinding&&(GLctx.currentArrayBufferBinding=0),r==GLctx.currentElementArrayBufferBinding&&(GLctx.currentElementArrayBufferBinding=0),r==GLctx.currentPixelPackBufferBinding&&(GLctx.currentPixelPackBufferBinding=0),r==GLctx.currentPixelUnpackBufferBinding&&(GLctx.currentPixelUnpackBufferBinding=0))}}function _glDeleteFramebuffers(e,t){for(var n=0;n<e;++n){var r=0|SAFE_HEAP_LOAD(t+4*n|0,4,0),o=GL.framebuffers[r];o&&(GLctx.deleteFramebuffer(o),o.name=0,GL.framebuffers[r]=null)}}function _glDeleteProgram(e){var t;e&&((t=GL.programs[e])?(GLctx.deleteProgram(t),t.name=0,GL.programs[e]=null):GL.recordError(1281))}function _glDeleteRenderbuffers(e,t){for(var n=0;n<e;n++){var r=0|SAFE_HEAP_LOAD(t+4*n|0,4,0),o=GL.renderbuffers[r];o&&(GLctx.deleteRenderbuffer(o),o.name=0,GL.renderbuffers[r]=null)}}function _glDeleteShader(e){var t;e&&((t=GL.shaders[e])?(GLctx.deleteShader(t),GL.shaders[e]=null):GL.recordError(1281))}function _glDeleteTextures(e,t){for(var n=0;n<e;n++){var r=0|SAFE_HEAP_LOAD(t+4*n|0,4,0),o=GL.textures[r];o&&(GLctx.deleteTexture(o),o.name=0,GL.textures[r]=null)}}function _glDeleteVertexArrays(e,t){for(var n=0;n<e;n++){var r=0|SAFE_HEAP_LOAD(t+4*n|0,4,0);GLctx.deleteVertexArray(GL.vaos[r]),GL.vaos[r]=null}}function _glDepthFunc(e){GLctx.depthFunc(e)}function _glDepthMask(e){GLctx.depthMask(!!e)}function _glDepthRange(e,t){GLctx.depthRange(e,t)}function _glDetachShader(e,t){GLctx.detachShader(GL.programs[e],GL.shaders[t])}function _glDisable(e){GLctx.disable(e)}function _glDisableClientState(){}function _glDisableVertexAttribArray(e){GL.currentContext.clientBuffers[e].enabled=!1,GLctx.disableVertexAttribArray(e)}function _glDrawArrays(e,t,n){GL.preDrawHandleClientVertexAttribBindings(t+n),GLctx.drawArrays(e,t,n),GL.postDrawHandleClientVertexAttribBindings()}function _glDrawBuffer(){}var tempFixedLengthArray=[];function _glDrawBuffers(e,t){for(var n=tempFixedLengthArray[e],r=0;r<e;r++)n[r]=0|SAFE_HEAP_LOAD(t+4*r|0,4,0);GLctx.drawBuffers(n)}for(var GLctx,i=0;i<32;++i)tempFixedLengthArray.push(new Array(i));function _glDrawElements(e,t,n,r){var o,i;GLctx.currentElementArrayBufferBinding||(o=GL.calcBufLength(1,n,0,t),i=GL.getTempIndexBuffer(o),GLctx.bindBuffer(34963,i),GLctx.bufferSubData(34963,0,HEAPU8.subarray(r,r+o)),r=0),GL.preDrawHandleClientVertexAttribBindings(t),GLctx.drawElements(e,t,n,r),GL.postDrawHandleClientVertexAttribBindings(t),GLctx.currentElementArrayBufferBinding||GLctx.bindBuffer(34963,null)}function _glEnable(e){GLctx.enable(e)}function _glEnableClientState(){}function _glEnableVertexAttribArray(e){GL.currentContext.clientBuffers[e].enabled=!0,GLctx.enableVertexAttribArray(e)}function _glEnd(){}function _glFinish(){GLctx.finish()}function _glFlush(){GLctx.flush()}function _glFramebufferRenderbuffer(e,t,n,r){GLctx.framebufferRenderbuffer(e,t,n,GL.renderbuffers[r])}function _glFramebufferTexture2D(e,t,n,r,o){GLctx.framebufferTexture2D(e,t,n,GL.textures[r],o)}function _glFrustum(){}function __glGenObject(e,t,n,r){for(var o=0;o<e;o++){var i=GLctx[n](),s=i&&GL.getNewId(r);i?r[i.name=s]=i:GL.recordError(1282),SAFE_HEAP_STORE(t+4*o|0,0|s,4)}}function _glGenBuffers(e,t){__glGenObject(e,t,"createBuffer",GL.buffers)}function _glGenFramebuffers(e,t){__glGenObject(e,t,"createFramebuffer",GL.framebuffers)}function _glGenRenderbuffers(e,t){__glGenObject(e,t,"createRenderbuffer",GL.renderbuffers)}function loadImage(n,r,o){var i=addressToString(n),s=stringToAddress("DEADBEEF"),a=(EMGL.previousImage=null,EMGL.previousName="",HEAP32[s>>2]=0,document.querySelector(`IMG[title="${i}"]`));if(a)return EMGL.previousName=i,EMGL.previousImage=a,void(HEAP32[r>>2]=1);if(0<(a=FS_ReadFile(n,s))&&0<HEAPU32[s>>2]){let e=document.createElement("IMG"),t=(EMGL.previousName=i,(EMGL.previousImage=e).onload=function(e){HEAP32[e.target.address-16>>2]=e.target.width,HEAP32[e.target.address-12>>2]=e.target.height,R_FinishImage3(e.target.address-28,6408,0)},Array.from(HEAPU8.slice(HEAPU32[s>>2],HEAPU32[s>>2]+a)));n=t.map(function(e){return String.fromCharCode(e)}).join("");return e.src="data:image/"+o+";base64,"+btoa(n),e.name=i,HEAP32[r>>2]=1,void FS_FreeFile(HEAPU32[s>>2])}EMGL.previousName="",EMGL.previousImage=null,HEAP32[r>>2]=null}function R_LoadPNG(e,t){return loadImage(e,t,"png")}function R_LoadJPG(e,t){return loadImage(e,t,"jpg")}function _glGenTextures(e,t){__glGenObject(e,t,"createTexture",GL.textures);e=HEAP32[t>>2];EMGL.texFiles[e]=[t,null];let n=addressToString(HEAPU32[EMGL.texFiles[e][0]-28>>2]);0!=n.length&&(EMGL.previousImage&&EMGL.previousName.replace(/\..*?$/,"")==n.replace(/\..*?$/,"")&&(EMGL.previousImage.address=EMGL.texFiles[e][0],EMGL.texFiles[e][1]=EMGL.previousImage,0<EMGL.previousImage.width&&0<EMGL.previousImage.height&&(HEAP32[t-16>>2]=EMGL.previousImage.width,HEAP32[t-12>>2]=EMGL.previousImage.height)),EMGL.previousImage=null,EMGL.previousName="")}function _glGenVertexArrays(e,t){__glGenObject(e,t,"createVertexArray",GL.vaos)}function _glGenerateMipmap(e){GLctx.generateMipmap(e)}function __glGetActiveAttribOrUniform(e,t,n,r,o,i,s,a){t=GL.programs[t];e=GLctx[e](t,n);e&&(t=a&&stringToAddress(e.name,a,r),o&&SAFE_HEAP_STORE(0|o,0|t,4),i&&SAFE_HEAP_STORE(0|i,0|e.size,4),s&&SAFE_HEAP_STORE(0|s,0|e.type,4))}function _glGetActiveUniform(e,t,n,r,o,i,s){__glGetActiveAttribOrUniform("getActiveUniform",e,t,n,r,o,i,s)}function readI53FromI64(e){return SAFE_HEAP_LOAD(4*(e>>2),4,1)+4294967296*SAFE_HEAP_LOAD(4*(e+4>>2),4,0)}function readI53FromU64(e){return SAFE_HEAP_LOAD(4*(e>>2),4,1)+4294967296*SAFE_HEAP_LOAD(4*(e+4>>2),4,1)}function writeI53ToI64(e,t){SAFE_HEAP_STORE(4*(e>>2),t,4),SAFE_HEAP_STORE(4*(e+4>>2),(t-SAFE_HEAP_LOAD(4*(e>>2),4,1))/4294967296,4);var n=(0<=t?readI53FromU64:readI53FromI64)(e);n!=t&&warnOnce("writeI53ToI64() out of range: serialized JS Number "+t+" to Wasm heap as bytes lo=0x"+SAFE_HEAP_LOAD(4*(e>>2),4,1).toString(16)+", hi=0x"+SAFE_HEAP_LOAD(4*(e+4>>2),4,1).toString(16)+", which deserializes back to "+n+" instead!")}function emscriptenWebGLGet(t,e,n){if(e){var r=void 0;switch(t){case 36346:r=1;break;case 36344:return void(0!=n&&1!=n&&GL.recordError(1280));case 34814:case 36345:r=0;break;case 34466:var o=GLctx.getParameter(34467),r=o?o.length:0;break;case 33309:if(GL.currentContext.version<2)return void GL.recordError(1282);r=2*(GLctx.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(GL.currentContext.version<2)return void GL.recordError(1280);r=33307==t?3:0}if(void 0===r){var i=GLctx.getParameter(t);switch(typeof i){case"number":r=i;break;case"boolean":r=i?1:0;break;case"string":return void GL.recordError(1280);case"object":if(null===i)switch(t){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:r=0;break;default:return void GL.recordError(1280)}else{if(i instanceof Float32Array||i instanceof Uint32Array||i instanceof Int32Array||i instanceof Array){for(var s=0;s<i.length;++s)switch(n){case 0:SAFE_HEAP_STORE(e+4*s|0,0|i[s],4);break;case 2:SAFE_HEAP_STORE_D(e+4*s|0,Math.fround(i[s]),4);break;case 4:SAFE_HEAP_STORE(e+s|0,0|(i[s]?1:0),1)}return}try{r=0|i.name}catch(e){return GL.recordError(1280),void err("GL_INVALID_ENUM in glGet"+n+"v: Unknown object returned from WebGL getParameter("+t+")! (error: "+e+")")}}break;default:return GL.recordError(1280),void err("GL_INVALID_ENUM in glGet"+n+"v: Native code calling glGet"+n+"v("+t+") and it returns "+i+" of type "+typeof i+"!")}}switch(n){case 1:writeI53ToI64(e,r);break;case 0:SAFE_HEAP_STORE(0|e,0|r,4);break;case 2:SAFE_HEAP_STORE_D(0|e,Math.fround(r),4);break;case 4:SAFE_HEAP_STORE(0|e,0|(r?1:0),1)}}else GL.recordError(1281)}function _glGetBooleanv(e,t){emscriptenWebGLGet(e,t,4)}function _glGetError(){var e=GLctx.getError()||GL.lastError;return GL.lastError=0,e}function _glGetIntegerv(e,t){emscriptenWebGLGet(e,t,0)}function _glGetProgramInfoLog(e,t,n,r){e=GLctx.getProgramInfoLog(GL.programs[e]),null===e&&(e="(unknown error)"),e=0<t&&r?stringToAddress(e,r,t):0;n&&SAFE_HEAP_STORE(0|n,0|e,4)}function _glGetProgramiv(e,t,n){if(n)if(e>=GL.counter)GL.recordError(1281);else if(e=GL.programs[e],35716==t){var r=GLctx.getProgramInfoLog(e);SAFE_HEAP_STORE(0|n,(r=null===r?"(unknown error)":r).length+1|0,4)}else if(35719==t){if(!e.maxUniformLength)for(var o=0;o<GLctx.getProgramParameter(e,35718);++o)e.maxUniformLength=Math.max(e.maxUniformLength,GLctx.getActiveUniform(e,o).name.length+1);SAFE_HEAP_STORE(0|n,0|e.maxUniformLength,4)}else if(35722==t){if(!e.maxAttributeLength)for(o=0;o<GLctx.getProgramParameter(e,35721);++o)e.maxAttributeLength=Math.max(e.maxAttributeLength,GLctx.getActiveAttrib(e,o).name.length+1);SAFE_HEAP_STORE(0|n,0|e.maxAttributeLength,4)}else if(35381==t){if(!e.maxUniformBlockNameLength)for(o=0;o<GLctx.getProgramParameter(e,35382);++o)e.maxUniformBlockNameLength=Math.max(e.maxUniformBlockNameLength,GLctx.getActiveUniformBlockName(e,o).length+1);SAFE_HEAP_STORE(0|n,0|e.maxUniformBlockNameLength,4)}else SAFE_HEAP_STORE(0|n,0|GLctx.getProgramParameter(e,t),4);else GL.recordError(1281)}function _glGetShaderInfoLog(e,t,n,r){e=GLctx.getShaderInfoLog(GL.shaders[e]),null===e&&(e="(unknown error)"),e=0<t&&r?stringToAddress(e,r,t):0;n&&SAFE_HEAP_STORE(0|n,0|e,4)}function _glGetShaderSource(e,t,n,r){var e=GLctx.getShaderSource(GL.shaders[e]);e&&(e=0<t&&r?stringToAddress(e,r,t):0,n&&SAFE_HEAP_STORE(0|n,0|e,4))}function _glGetShaderiv(e,t,n){n?SAFE_HEAP_STORE(0|n,35716==t?0|((n=null===(n=GLctx.getShaderInfoLog(GL.shaders[e]))?"(unknown error)":n)?n.length+1:0):35720==t?0|((n=GLctx.getShaderSource(GL.shaders[e]))?n.length+1:0):0|GLctx.getShaderParameter(GL.shaders[e],t),4):GL.recordError(1281)}function _glGetString(e){if(!(n=GL.stringCache[e])){switch(e){case 7939:var t=GLctx.getSupportedExtensions()||[],n=stringToAddress((t=t.concat(t.map(function(e){return"GL_"+e}))).join(" "));break;case 7936:case 7937:case 37445:case 37446:t=GLctx.getParameter(e);t||GL.recordError(1280),n=t&&stringToAddress(t);break;case 7938:t=GLctx.getParameter(7938);n=stringToAddress(t="OpenGL ES 3.0 ("+t+")");break;case 35724:var t=GLctx.getParameter(35724),r=t.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);null!==r&&(3==r[1].length&&(r[1]=r[1]+"0"),t="OpenGL ES GLSL ES "+r[1]+" ("+t+")"),n=stringToAddress(t);break;default:GL.recordError(1280)}GL.stringCache[e]=n}return n}function _glGetStringi(e,t){if(GL.currentContext.version<2)return GL.recordError(1282),0;var n=GL.stringiCache[e];if(n)return t<0||t>=n.length?(GL.recordError(1281),0):n[t];if(7939!==e)return GL.recordError(1280),0;var r=GLctx.getSupportedExtensions()||[];return r=(r=r.concat(r.map(function(e){return"GL_"+e}))).map(function(e){return stringToAddress(e)}),n=GL.stringiCache[e]=r,t<0||t>=n.length?(GL.recordError(1281),0):n[t]}function jstoi_q(e){return parseInt(e)}function webglGetLeftBracePos(e){return"]"==e.slice(-1)&&e.lastIndexOf("[")}function webglPrepareUniformLocationsBeforeFirstUse(e){var t,n,r=e.uniformLocsById,o=e.uniformSizeAndIdsByName;if(!r)for(e.uniformLocsById=r={},e.uniformArrayNamesById={},t=0;t<GLctx.getProgramParameter(e,35718);++t){var i=GLctx.getActiveUniform(e,t),s=i.name,a=i.size,i=webglGetLeftBracePos(s),l=0<i?s.slice(0,i):s,c=e.uniformIdCounter;for(e.uniformIdCounter+=a,o[l]=[a,c],n=0;n<a;++n)r[c]=n,e.uniformArrayNamesById[c++]=l}}function _glGetUniformLocation(e,t){if(t=addressToString(t),e=GL.programs[e]){webglPrepareUniformLocationsBeforeFirstUse(e);var n=e.uniformLocsById,r=0,o=t,i=webglGetLeftBracePos(t),i=(0<i&&(r=jstoi_q(t.slice(i+1))>>>0,o=t.slice(0,i)),e.uniformSizeAndIdsByName[o]);if(i&&r<i[0]&&(n[r+=i[1]]=n[r]||GLctx.getUniformLocation(e,t)))return r}else GL.recordError(1281);return-1}function _glLineWidth(e){GLctx.lineWidth(e)}function _glLinkProgram(e){e=GL.programs[e],GLctx.linkProgram(e),e.uniformLocsById=0,e.uniformSizeAndIdsByName={}}function _glLoadIdentity(){throw"Legacy GL function (glLoadIdentity) called. If you want legacy GL emulation, you need to compile with -s LEGACY_GL_EMULATION=1 to enable legacy GL emulation."}function _glLoadMatrixf(){}function _glMapBufferRange(){}function _glMatrixMode(){throw"Legacy GL function (glMatrixMode) called. If you want legacy GL emulation, you need to compile with -s LEGACY_GL_EMULATION=1 to enable legacy GL emulation."}function _glOrtho(){}function _glPolygonMode(){}function _glPolygonOffset(e,t){GLctx.polygonOffset(e,t)}function _glPopMatrix(){}function _glPushMatrix(){}function _glReadBuffer(e){GLctx.readBuffer(e)}function computeUnpackAlignedImageSize(e,t,n,r){return t*(e*n+r-1&-r)}function __colorChannelsInGlTextureFormat(e){return{5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[e-6402]||1}function heapObjectForWebGLType(e){return 0==(e-=5120)?HEAP8:1==e?HEAPU8:2==e?HEAP16:4==e?HEAP32:6==e?HEAPF32:5==e||28922==e||28520==e||30779==e||30782==e?HEAPU32:HEAPU16}function heapAccessShiftForWebGLHeap(e){return 31-Math.clz32(e.BYTES_PER_ELEMENT)}function emscriptenWebGLGetTexPixelData(e,t,n,r,o,i){var e=heapObjectForWebGLType(e),s=heapAccessShiftForWebGLHeap(e),a=1<<s,n=computeUnpackAlignedImageSize(n,r,__colorChannelsInGlTextureFormat(t)*a,GL.unpackAlignment);return e.subarray(o>>s,o+n>>s)}function _glReadPixels(e,t,n,r,o,i,s){var a;GLctx.currentPixelPackBufferBinding?GLctx.readPixels(e,t,n,r,o,i,s):(a=heapObjectForWebGLType(i),GLctx.readPixels(e,t,n,r,o,i,a,s>>heapAccessShiftForWebGLHeap(a)))}function _glRenderbufferStorage(e,t,n,r){GLctx.renderbufferStorage(e,t,n,r)}function _glRenderbufferStorageMultisample(e,t,n,r,o){GLctx.renderbufferStorageMultisample(e,t,n,r,o)}function _glScissor(e,t,n,r){GLctx.scissor(e,t,n,r)}function _glShadeModel(){}function _glShaderSource(e,t,n,r){t=GL.getSource(e,t,n,r);GLctx.shaderSource(GL.shaders[e],t)}function _glStencilFunc(e,t,n){GLctx.stencilFunc(e,t,n)}function _glStencilMask(e){GLctx.stencilMask(e)}function _glStencilOp(e,t,n){GLctx.stencilOp(e,t,n)}function _glTexCoord2f(){}function _glTexCoord2fv(){}function _glTexCoordPointer(){}function _glTexEnvf(){}function _glTexImage2D(e,t,n,r,o,i,s,a,l){var c;GLctx.currentPixelUnpackBufferBinding?GLctx.texImage2D(e,t,n,r,o,i,s,a,l):l?(c=heapObjectForWebGLType(a),GLctx.texImage2D(e,t,n,r,o,i,s,a,c,l>>heapAccessShiftForWebGLHeap(c))):GLctx.texImage2D(e,t,n,r,o,i,s,a,null)}function _glTexParameterf(e,t,n){GLctx.texParameterf(e,t,n)}function _glTexParameteri(e,t,n){GLctx.texParameteri(e,t,n)}function _glTexSubImage2D(e,t,n,r,o,i,s,a,l){if(EMGL.previousImage)return o<=2||i<=2?void 0:void GLctx.texSubImage2D(e,t,n,r,o,i,s,a,EMGL.previousImage);var c;void 0!==EMGL.texFiles[EMGL.previousTex]&&EMGL.texFiles[EMGL.previousTex][1]||(GLctx.currentPixelUnpackBufferBinding?GLctx.texSubImage2D(e,t,n,r,o,i,s,a,l):l?(c=heapObjectForWebGLType(a),GLctx.texSubImage2D(e,t,n,r,o,i,s,a,c,l>>heapAccessShiftForWebGLHeap(c))):GLctx.texSubImage2D(e,t,n,r,o,i,s,a,null))}function _glTranslatef(){}function webglGetUniformLocation(e){var t,n=GLctx.currentProgram;if(n)return"number"==typeof(t=n.uniformLocsById[e])&&(n.uniformLocsById[e]=t=GLctx.getUniformLocation(n,n.uniformArrayNamesById[e]+(0<t?"["+t+"]":""))),t;GL.recordError(1282)}function _glUniform1f(e,t){GLctx.uniform1f(webglGetUniformLocation(e),t)}function _glUniform1fv(e,t,n){GLctx.uniform1fv(webglGetUniformLocation(e),HEAPF32,n>>2,t)}function _glUniform1i(e,t){GLctx.uniform1i(webglGetUniformLocation(e),t)}function _glUniform2f(e,t,n){GLctx.uniform2f(webglGetUniformLocation(e),t,n)}function _glUniform3f(e,t,n,r){GLctx.uniform3f(webglGetUniformLocation(e),t,n,r)}function _glUniform4f(e,t,n,r,o){GLctx.uniform4f(webglGetUniformLocation(e),t,n,r,o)}function _glUniformMatrix4fv(e,t,n,r){GLctx.uniformMatrix4fv(webglGetUniformLocation(e),!!n,HEAPF32,r>>2,16*t)}function _glUnmapBuffer(){}function _glUseProgram(e){e=GL.programs[e],GLctx.useProgram(e),GLctx.currentProgram=e}function _glValidateProgram(e){GLctx.validateProgram(GL.programs[e])}function _glVertex2f(){}function _glVertex3f(){}function _glVertex3fv(){}function _glVertexAttribPointer(e,t,n,r,o,i){var s=GL.currentContext.clientBuffers[e];if(!GLctx.currentArrayBufferBinding)return s.size=t,s.type=n,s.normalized=r,s.stride=o,s.ptr=i,s.clientside=!0,void(s.vertexAttribPointerAdaptor=function(e,t,n,r,o,i){this.vertexAttribPointer(e,t,n,r,o,i)});s.clientside=!1,GLctx.vertexAttribPointer(e,t,n,!!r,o,i)}function _glVertexPointer(){throw"Legacy GL function (glVertexPointer) called. If you want legacy GL emulation, you need to compile with -s LEGACY_GL_EMULATION=1 to enable legacy GL emulation."}function _glViewport(e,t,n,r){GLctx.viewport(e,t,n,r)}function _setTempRet0(e){setTempRet0(e)}function GL_GetDrawableSize(e,t){HEAP32[e+0>>2]=Q3e.canvas.width,HEAP32[t+0>>2]=Q3e.canvas.height}var EMGL={previousName:"",previousImage:null,previousTex:0,texFiles:{},GL_GetDrawableSize:GL_GetDrawableSize,GL_GetProcAddress:function(){},R_LoadPNG:R_LoadPNG,R_LoadJPG:R_LoadJPG,getTempRet0:_getTempRet0,glActiveTexture:_glActiveTexture,glAlphaFunc:_glAlphaFunc,glArrayElement:_glArrayElement,glAttachShader:_glAttachShader,glBegin:_glBegin,glBindAttribLocation:_glBindAttribLocation,glBindBuffer:_glBindBuffer,glBindFramebuffer:_glBindFramebuffer,glBindRenderbuffer:_glBindRenderbuffer,glBindTexture:_glBindTexture,glBindVertexArray:_glBindVertexArray,glBlendFunc:_glBlendFunc,glBlitFramebuffer:_glBlitFramebuffer,glBufferData:_glBufferData,glBufferSubData:_glBufferSubData,glCheckFramebufferStatus:_glCheckFramebufferStatus,glClear:_glClear,glClearColor:_glClearColor,glClearDepth:_glClearDepth,glClearStencil:_glClearStencil,glClipPlane:_glClipPlane,glColor3f:_glColor3f,glColor4f:_glColor4f,glColor4ubv:_glColor4ubv,glColorMask:_glColorMask,glColorPointer:_glColorPointer,glCompileShader:_glCompileShader,glCompressedTexImage2D:_glCompressedTexImage2D,glCompressedTexSubImage2D:_glCompressedTexSubImage2D,glCopyTexSubImage2D:_glCopyTexSubImage2D,glCreateProgram:_glCreateProgram,glCreateShader:_glCreateShader,glCullFace:_glCullFace,glDeleteBuffers:_glDeleteBuffers,glDeleteFramebuffers:_glDeleteFramebuffers,glDeleteProgram:_glDeleteProgram,glDeleteRenderbuffers:_glDeleteRenderbuffers,glDeleteShader:_glDeleteShader,glDeleteTextures:_glDeleteTextures,glDeleteVertexArrays:_glDeleteVertexArrays,glDepthFunc:_glDepthFunc,glDepthMask:_glDepthMask,glDepthRange:_glDepthRange,glDetachShader:_glDetachShader,glDisable:_glDisable,glDisableClientState:_glDisableClientState,glDisableVertexAttribArray:_glDisableVertexAttribArray,glDrawArrays:_glDrawArrays,glDrawBuffer:_glDrawBuffer,glDrawBuffers:_glDrawBuffers,glDrawElements:_glDrawElements,glEnable:_glEnable,glEnableClientState:_glEnableClientState,glEnableVertexAttribArray:_glEnableVertexAttribArray,glEnd:_glEnd,glFinish:_glFinish,glFlush:_glFlush,glFramebufferRenderbuffer:_glFramebufferRenderbuffer,glFramebufferTexture2D:_glFramebufferTexture2D,glFrustum:_glFrustum,glGenBuffers:_glGenBuffers,glGenFramebuffers:_glGenFramebuffers,glGenRenderbuffers:_glGenRenderbuffers,glGenTextures:_glGenTextures,glGenVertexArrays:_glGenVertexArrays,glGenerateMipmap:_glGenerateMipmap,glGetActiveUniform:_glGetActiveUniform,glGetBooleanv:_glGetBooleanv,glGetError:_glGetError,glGetIntegerv:_glGetIntegerv,glGetProgramInfoLog:_glGetProgramInfoLog,glGetProgramiv:_glGetProgramiv,glGetShaderInfoLog:_glGetShaderInfoLog,glGetShaderSource:_glGetShaderSource,glGetShaderiv:_glGetShaderiv,glGetString:_glGetString,glGetStringi:_glGetStringi,glGetUniformLocation:_glGetUniformLocation,glLineWidth:_glLineWidth,glLinkProgram:_glLinkProgram,glLoadIdentity:_glLoadIdentity,glLoadMatrixf:_glLoadMatrixf,glMapBufferRange:_glMapBufferRange,glMatrixMode:_glMatrixMode,glOrtho:_glOrtho,glPolygonMode:_glPolygonMode,glPolygonOffset:_glPolygonOffset,glPopMatrix:_glPopMatrix,glPushMatrix:_glPushMatrix,glReadBuffer:_glReadBuffer,glReadPixels:_glReadPixels,glRenderbufferStorage:_glRenderbufferStorage,glRenderbufferStorageMultisample:_glRenderbufferStorageMultisample,glScissor:_glScissor,glShadeModel:_glShadeModel,glShaderSource:_glShaderSource,glStencilFunc:_glStencilFunc,glStencilMask:_glStencilMask,glStencilOp:_glStencilOp,glTexCoord2f:_glTexCoord2f,glTexCoord2fv:_glTexCoord2fv,glTexCoordPointer:_glTexCoordPointer,glTexEnvf:_glTexEnvf,glTexImage2D:_glTexImage2D,glTexParameterf:_glTexParameterf,glTexParameteri:_glTexParameteri,glTexSubImage2D:_glTexSubImage2D,glTranslatef:_glTranslatef,glUniform1f:_glUniform1f,glUniform1fv:_glUniform1fv,glUniform1i:_glUniform1i,glUniform2f:_glUniform2f,glUniform3f:_glUniform3f,glUniform4f:_glUniform4f,glUniformMatrix4fv:_glUniformMatrix4fv,glUnmapBuffer:_glUnmapBuffer,glUseProgram:_glUseProgram,glValidateProgram:_glValidateProgram,glVertex2f:_glVertex2f,glVertex3f:_glVertex3f,glVertex3fv:_glVertex3fv,glVertexAttribPointer:_glVertexAttribPointer,glVertexPointer:_glVertexPointer,glViewport:_glViewport},DB_STORE_NAME="FILE_DATA";function openDatabase(e){if(FS.database)return Promise.resolve(FS.database);if(FS.database||FS.open&&!(3e3<Date.now()-FS.openTime)){if(e)throw new Error("no database");return new Promise(function(e){setTimeout(function(){openDatabase(!0).then(e)},1e3)})}return FS.openTime=Date.now(),new Promise(function(t){FS.open=indexedDB.open("/base",22),FS.open.onsuccess=function(e){FS.database=e.target.result,t(FS.database)},FS.open.onupgradeneeded=function(){let e=FS.open.result.createObjectStore(DB_STORE_NAME);e.indexNames.contains("timestamp")||e.createIndex("timestamp","timestamp",{unique:!1})},FS.open.onerror=function(e){console.error(e),t(e)}})}function readAll(){let o=Date.now();return console.log("sync started at ",new Date),openDatabase().then(function(e){let t=e.transaction([DB_STORE_NAME],"readonly"),n=t.objectStore(DB_STORE_NAME),r=n.openCursor();return new Promise(function(n){r.onsuccess=function(e){let t=e.target.result;return t?(FS.virtual[t.key]={timestamp:t.value.timestamp,mode:t.value.mode,contents:t.value.contents},t.continue()):n()},r.onerror=function(e){console.error(e),n(e)}}).then(function(){t.commit();var e=Date.now()-o;console.log("sync completed",new Date),console.log("sync took",(6e4<e?Math.floor(e/1e3/60)+" minutes, ":"")+Math.floor(e/1e3)%60+" seconds, "+e%1e3+" milliseconds")})}).catch(function(e){console.log(e)})}function readStore(o){return openDatabase().then(function(e){let n=e.transaction([DB_STORE_NAME],"readwrite"),r=n.objectStore(DB_STORE_NAME);return new Promise(function(t){let e=r.get(o);e.onsuccess=function(e){t(e.target.result)},e.onerror=function(e){console.error(e),t(e)},n.commit()})}).catch(function(e){})}function writeStore(o,i){return openDatabase().then(function(e){let n=e.transaction([DB_STORE_NAME],"readwrite"),r=n.objectStore(DB_STORE_NAME);return new Promise(function(t){let e;(e=!1===o?r.delete(i):r.put(o,i)).onsuccess=function(){},n.oncomplete=function(e){t(e.target.result)},e.onerror=function(e){console.error(e,o,i)},n.commit()})}).catch(function(e){})}function Sys_Mkdir(e){let t=addressToString(e);"/"==(t=t.startsWith("/base")||t.startsWith("/home")?t.substring("/base".length):t)[0]&&(t=t.substring(1)),FS.virtual[t]={timestamp:new Date,mode:16895},openDatabase().then(function(e){writeStore(FS.virtual[t],t)})}function Sys_GetFileStats(e,t,n,r){let o=addressToString(e);return"/"==(o=o.startsWith("/base")||o.startsWith("/home")?o.substring("/base".length):o)[0]&&(o=o.substring(1)),void 0!==FS.virtual[o]?(HEAP32[t>>2]=(FS.virtual[o].contents||[]).length,HEAP32[n>>2]=FS.virtual[o].timestamp.getTime(),HEAP32[r>>2]=FS.virtual[o].timestamp.getTime(),1):(HEAP32[t>>2]=0,HEAP32[n>>2]=0,HEAP32[r>>2]=0)}function Sys_FOpen(e,t){e=addressToString(e);let n=addressToString(t),r=e;"/"==(r=r.startsWith("/base")||r.startsWith("/home")?r.substring("/base".length):r)[0]&&(r=r.substring(1));function o(){return FS.filePointer++,FS.pointers[FS.filePointer]=[0,n,FS.virtual[r],r],FS.filePointer}return void 0!==FS.virtual[r]?o():!n.includes("w")||(t=r.substring(0,r.lastIndexOf("/")).length)&&void 0===FS.virtual[t]?0:(FS.virtual[r]={timestamp:new Date,mode:33206,contents:new Uint8Array(0)},o())}function Sys_FTell(e){if(void 0===FS.pointers[e])throw new Error("File IO Error");return FS.pointers[e][0]}function Sys_FSeek(e,t,n){if(void 0===FS.pointers[e])throw new Error("File IO Error");if(0==n)FS.pointers[e][0]=t;else if(1==n)FS.pointers[e][0]+=t;else{if(2!=n)return-1;FS.pointers[e][0]=FS.pointers[e][2].contents.length+t}return 0}function Sys_FClose(e){if(void 0===FS.pointers[e])throw new Error("File IO Error");writeStore(FS.pointers[e][2],FS.pointers[e][3]),FS.pointers[e]=void 0}function Sys_FWrite(e,t,n,r){if(void 0===FS.pointers[r])throw new Error("File IO Error");let o=FS.pointers[r][2].contents;return FS.pointers[r][0]+t*n>FS.pointers[r][2].contents.length&&(o=new Uint8Array(FS.pointers[r][2].contents.length+t*n)).set(new Uint8Array(FS.pointers[r][2].contents),0),o.set(new Uint8Array(HEAP8.slice(e,e+t*n)),FS.pointers[r][0]),FS.pointers[r][2].contents=o,t*n}function Sys_FFlush(e){if(void 0===FS.pointers[e])throw new Error("File IO Error");writeStore(FS.pointers[e][2],FS.pointers[e][3])}function Sys_FRead(e,t,n,r){if(void 0===FS.pointers[r])throw new Error("File IO Error");let o=0;for(;o<n*t&&!(FS.pointers[r][0]>=FS.pointers[r][2].contents.length);o++)HEAP8[e+o]=FS.pointers[r][2].contents[FS.pointers[r][0]],FS.pointers[r][0]++;return(o-o%t)/t}function Sys_Remove(e){let t=addressToString(e);"/"==(t=t.startsWith("/base")||t.startsWith("/home")?t.substring("/base".length):t)[0]&&(t=t.substring(1)),void 0!==FS.virtual[t]&&(delete FS.virtual[t],writeStore(!1,t))}function Sys_Rename(e,t){let n=addressToString(e),r=("/"==(n=n.startsWith("/base")||n.startsWith("/home")?n.substring("/base".length):n)[0]&&(n=n.substring(1)),addressToString(t));"/"==(r=r.startsWith("/base")||r.startsWith("/home")?r.substring("/base".length):r)[0]&&(r=r.substring(1))}function Sys_ListFiles(e,t,n,r,o){let i=addressToString(e),s=("/"==(i=i.startsWith("/base")||i.startsWith("/home")?i.substring("/base".length):i)[0]&&(i=i.substring(1)),addressToString(t));var a=Object.keys(FS.virtual).filter(function(e){return(!s||e.endsWith(s)||"/"==s&&16895==FS.virtual[e].mode)&&(!i||e.startsWith(i))&&(!o||16895==FS.virtual[e].mode)}),l=Z_Malloc(4*(a.length+1));for(let t=0;t<a.length;t++){let e=a[t];"/"==(e=i&&e.startsWith(i)?e.substring(i.length):e)[0]&&(e=e.substring(1)),HEAPU32[l+4*t>>2]=FS_CopyString(stringToAddress(e))}return HEAP32[(l>>2)+a.length]=0,HEAP32[r>>2]=a.length,l}var FS={pointers:{},filePointer:0,virtual:{},Sys_ListFiles:Sys_ListFiles,Sys_FTell:Sys_FTell,Sys_FSeek:Sys_FSeek,Sys_FClose:Sys_FClose,Sys_FWrite:Sys_FWrite,Sys_FFlush:Sys_FFlush,Sys_FRead:Sys_FRead,Sys_FOpen:Sys_FOpen,Sys_Remove:Sys_Remove,Sys_Rename:Sys_Rename,Sys_GetFileStats:Sys_GetFileStats,Sys_Mkdir:Sys_Mkdir};function GLimp_StartDriverAndSetMode(e,t,n,r){Q3e.canvas||(Q3e.canvas=document.createElement("canvas"),Q3e.canvas.setAttribute("width",document.body.clientWidth),Q3e.canvas.setAttribute("height",document.body.clientHeight),Q3e.canvas.width=document.body.clientWidth,Q3e.canvas.height=document.body.clientHeight,document.getElementById("viewport-frame").appendChild(Q3e.canvas));var o={failIfMajorPerformanceCaveat:!0,alpha:!1,stencil:!0,premultipliedAlpha:!1};return Q3e.webgl=r?Q3e.canvas.getContext("webgl",o)||Q3e.canvas.getContext("experimental-webgl"):Q3e.canvas.getContext("webgl2",o),Q3e.webgl.viewport(0,0,Q3e.canvas.width,Q3e.canvas.height),Q3e.webgl?(void 0!==GL&&(INPUT.handle=GL.registerContext(Q3e.webgl,o),GL.makeContextCurrent(INPUT.handle)),INPUT.firstClick&&SDL_ShowCursor(),0):2}function updateVideoCmd(){Q3e.canvas||(Q3e.canvas.setAttribute("width",canvas.clientWidth),Q3e.canvas.setAttribute("height",canvas.clientHeight)),Cvar_Set(stringToAddress("r_customWidth"),stringToAddress(""+Q3e.canvas.clientWidth)),Cvar_Set(stringToAddress("r_customHeight"),stringToAddress(""+Q3e.canvas.clientHeight))}function resizeViewport(){Q3e.canvas&&(Q3e.resizeDelay&&clearTimeout(Q3e.resizeDelay),Q3e.resizeDelay=setTimeout(updateVideoCmd,100))}const SE_NONE=0,SE_KEY=1,SE_FINGER_DOWN=2,SE_FINGER_UP=3,SE_CHAR=4,SE_MOUSE=5,SE_MOUSE_ABS=6,SE_JOYSTICK_AXIS=7,SE_CONSOLE=8,SE_MAX=9,SE_DROPBEGIN=10,SE_DROPCOMPLETE=11,SE_DROPFILE=12,SE_DROPTEXT=13,KEYCATCH_CONSOLE=1,KEYCATCH_UI=2,KEYCATCH_MESSAGE=4,KEYCATCH_CGAME=8;function InputPushFocusEvent(e){"pointerlockchange"==e.type?HEAP32[gw_active>>2]=document.pointerLockElement===Q3e.canvas:"visible"!=document.visibilityState||"blur"==e.type?(Key_ClearStates(),HEAP32[gw_active>>2]=!1):(Key_ClearStates(),HEAP32[gw_active>>2]=!0,HEAP32[gw_minimized>>2]=!1)}function InputPushMovedEvent(e){if(null===e.toElement&&null===e.relatedTarget)return INPUT.firstClick=!0,HEAP32[gw_active>>2]=!1,Q3e.frameInterval&&clearInterval(Q3e.frameInterval),void(Q3e.frameInterval=setInterval(Sys_Frame,1e3/INPUT.fpsUnfocused));e=!document.isFullScreen&&!document.webkitIsFullScreen&&!document.mozIsFullScreen;gw_active&&e&&(Cvar_SetIntegerValue(stringToAddress("vid_xpos"),stringToAddress(""+(window.screenX||window.screenLeft))),Cvar_SetIntegerValue(stringToAddress("vid_ypos"),stringToAddress(""+(window.screenY||window.screenTop))))}function captureClipBoard(){var e=document.createElement("TEXTAREA");e.style.opacity=0,e.style.height="1px",e.style.width="1px",e.style.display="block",e.style.zIndex=1e3,e.style.position="absolute",document.body.appendChild(e),e.focus(),setTimeout(function(){INPUT.paste=e.value,document.body.focus(),INPUT.field&&(INPUT.paste.split("").forEach(function(e){Field_CharEvent(INPUT.field,e.charCodeAt(0))}),INPUT.paste="",INPUT.field=0,e.remove())},100)}function checkPasteEvent(e){"Meta"==e.key&&(INPUT.superKey="keydown"==e.type),!INPUT.superKey||"v"!=e.key&&"V"!=e.key||!INPUT.superKey||"keypress"!=e.type&&"keydown"!=e.type||captureClipBoard()}function InputPushKeyEvent(e){if(8===e.keyCode&&(INPUT.cancelBackspace=!0,setTimeout(function(){INPUT.cancelBackspace=!1},100)),27===e.keyCode&&(INPUT.cancelBackspace=!0,SDL_ShowCursor(),HEAP32[gw_active>>2]=!1),checkPasteEvent(e),"keydown"==e.type){if(e.repeat&&0==Key_GetCatcher())return;var t;if(13==e.keyCode&&e.altKey)return t=!document.isFullScreen&&!document.webkitIsFullScreen&&!document.mozIsFullScreen,Cvar_SetIntegerValue(stringToAddress("r_fullscreen"),t?1:0),void Cbuf_AddText(stringToAddress("vid_restart\n"));8==e.keyCode&&Sys_QueEvent(Sys_Milliseconds(),SE_CHAR,8,0,0,null)}e.ctrlKey&&e.keyCode>="a".charCodeAt(0)&&e.keyCode<="z".charCodeAt(0)?Sys_QueEvent(Sys_Milliseconds(),SE_CHAR,e.charCode-"a".charCodeAt(0)+1,0,0,null):65<=e.keyCode&&e.keyCode<=90?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.a+(e.keyCode-65),"keydown"==e.type,0,null):e.shiftKey&&65<=e.keyCode&&e.keyCode<=90?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.a+(e.keyCode-65+97),"keydown"==e.type,0,null):48<=e.keyCode&&e.keyCode<=57?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings[0]+(e.keyCode-48),"keydown"==e.type,0,null):e.shiftKey&&48<=e.keyCode&&e.keyCode<=57?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings[" "]+(e.keyCode-48),"keydown"==e.type,0,null):37==e.keyCode?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.LEFTARROW,"keydown"==e.type,0,null):38==e.keyCode?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.UPARROW,"keydown"==e.type,0,null):39==e.keyCode?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.RIGHTARROW,"keydown"==e.type,0,null):40==e.keyCode?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.DOWNARROW,"keydown"==e.type,0,null):16==e.keyCode&&Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.SHIFT,"keydown"==e.type,0,null),32==e.keyCode&&Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.SPACE,"keydown"==e.type,0,null),13==e.keyCode?Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.ENTER,"keydown"==e.type,0,null):27==e.keyCode&&Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.ESCAPE,"keydown"==e.type,0,null)}function InputPushTextEvent(e){INPUT.consoleKeys.includes(String.fromCharCode(e.charCode))?(Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.CONSOLE,!0,0,null),Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.CONSOLE,!1,0,null),setTimeout(function(){Key_GetCatcher()&KEYCATCH_CONSOLE&&(SDL_ShowCursor(),HEAP32[gw_active>>2]=!1)},100)):Sys_QueEvent(Sys_Milliseconds(),SE_CHAR,e.charCode,0,0,null)}function getMovementX(e){return e.movementX||e.mozMovementX||e.webkitMovementX||0}function getMovementY(e){return e.movementY||e.mozMovementY||e.webkitMovementY||0}function InputPushWheelEvent(e){0<e.deltaY?(Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.MWHEELUP,!0,0,null),Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.MWHEELUP,!1,0,null)):e.deltaY<0&&(Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.MWHEELDOWN,!0,0,null),Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.MWHEELDOWN,!1,0,null))}function InputPushMouseEvent(e){var t="mousedown"==e.type;Key_GetCatcher()&KEYCATCH_CONSOLE?HEAP32[gw_active>>2]&&(SDL_ShowCursor(),HEAP32[gw_active>>2]=!1):"mousemove"!=e.type?(!t||HEAP32[gw_active>>2]&&document.pointerLockElement==Q3e.canvas||(HEAP32[gw_active>>2]=!0,Q3e.canvas.requestPointerLock(),INPUT.firstClick&&(INPUT.firstClick=!1,SNDDMA_Init()),Q3e.frameInterval&&clearInterval(Q3e.frameInterval),Q3e.frameInterval=setInterval(Sys_Frame,1e3/INPUT.fps)),Sys_QueEvent(Sys_Milliseconds(),SE_KEY,INPUT.keystrings.MOUSE1+e.button,t,0,null)):Sys_QueEvent(Sys_Milliseconds(),SE_MOUSE,getMovementX(e),getMovementY(e),0,null)}function Com_MaxFPSChanged(){INPUT.fpsUnfocused=Cvar_VariableIntegerValue(stringToAddress("com_maxfpsUnfocused")),INPUT.fps=Cvar_VariableIntegerValue(stringToAddress("com_maxfps")),Q3e.frameInterval&&clearInterval(Q3e.frameInterval),Q3e.frameInterval=setInterval(Sys_Frame,1e3/INPUT.fps)}function Sys_ConsoleInput(){var e=window.location.hash;return window.location.hash="",e.length?stringToAddress(e):null}const CVAR_ARCHIVE=1,CVAR_NODEFAULT=16384,CVAR_LATCH=32,CVAR_ARCHIVE_ND=CVAR_ARCHIVE|CVAR_NODEFAULT,CV_INTEGER=2;function IN_Init(){console.log("\n------- Input Initialization -------\n"),Cvar_VariableIntegerValue(stringToAddress("in_joystick"))&&InitNippleJoysticks();Cvar_Get(stringToAddress("in_keyboardDebug"),stringToAddress("0"),CVAR_ARCHIVE);var e=Cvar_Get(stringToAddress("in_mouse"),stringToAddress("1"),CVAR_ARCHIVE);Cvar_CheckRange(e,stringToAddress("-1"),stringToAddress("1"),CV_INTEGER),Cvar_Get(stringToAddress("cl_consoleKeys"),stringToAddress("~ ` ~ `"),CVAR_ARCHIVE),INPUT.consoleKeys||(INPUT.consoleKeys=addressToString(Cvar_VariableString(stringToAddress("cl_consoleKeys"))).split(" ").map(function(e){return"0"==e[0]&&"x"==e[1]?String.fromCharCode(parseInt(e.substr(2),16)):e}));for(let e=0;e<1024;e++){var t=addressToString(Key_KeynumToString(e));0!=t.length&&(INPUT.keystrings[t]=e)}window.addEventListener("keydown",InputPushKeyEvent,!1),window.addEventListener("keyup",InputPushKeyEvent,!1),window.addEventListener("keypress",InputPushTextEvent,!1),window.addEventListener("mouseout",InputPushMovedEvent,!1),window.addEventListener("resize",resizeViewport,!1),window.addEventListener("popstate",CL_ModifyMenu,!1),Q3e.canvas.addEventListener("mousemove",InputPushMouseEvent,!1),Q3e.canvas.addEventListener("mousedown",InputPushMouseEvent,!1),Q3e.canvas.addEventListener("mouseup",InputPushMouseEvent,!1),document.addEventListener("mousewheel",InputPushWheelEvent,{capture:!1,passive:!0}),document.addEventListener("visibilitychange",InputPushFocusEvent,!1),document.addEventListener("focus",InputPushFocusEvent,!1),document.addEventListener("blur",InputPushFocusEvent,!1),document.addEventListener("pointerlockchange",InputPushFocusEvent,!1),console.log("------------------------------------\n")}function InitNippleJoysticks(){if(document.body.classList.add("joysticks"),0<SYSI.joysticks.length)for(var e=0;e<SYSI.joysticks.length;e++)SYSI.joysticks[e].destroy();SYSI.joysticks[0]=nipplejs.create({zone:document.getElementById("left-joystick"),multitouch:!1,mode:"semi",size:100,catchDistance:50,maxNumberOfNipples:1,position:{bottom:"50px",left:"50px"}}),SYSI.joysticks[1]=nipplejs.create({zone:document.getElementById("right-joystick"),multitouch:!1,mode:"semi",size:100,catchDistance:50,maxNumberOfNipples:1,position:{bottom:"50px",right:"50px"}}),SYSI.joysticks[2]=nipplejs.create({dataOnly:!0,zone:document.body,multitouch:!1,mode:"dynamic",size:2,catchDistance:2,maxNumberOfNipples:1}),SYSI.joysticks[0].on("start end move",SYSI.InputPushTouchEvent.bind(null,SYSI.joysticks[0],1)),SYSI.joysticks[1].on("start end move",SYSI.InputPushTouchEvent.bind(null,SYSI.joysticks[1],2)),SYSI.joysticks[2].on("start end move",SYSI.InputPushTouchEvent.bind(null,SYSI.joysticks[2],3))}function SDL_SetWindowGrab(){}function SDL_StartTextInput(){}function SDL_StopTextInput(){SDL.textInput=!1}function SDL_ShowCursor(){document.exitPointerLock?document.exitPointerLock():document.webkitExitPointerLock?document.webkitExitPointerLock():document.mozExitPointerLock&&document.mozExitPointerLock()}function GLimp_Shutdown(e){window.removeEventListener("resize",resizeViewport),window.removeEventListener("keydown",InputPushKeyEvent),window.removeEventListener("keyup",InputPushKeyEvent),window.removeEventListener("keypress",InputPushTextEvent),window.removeEventListener("mouseout",InputPushMovedEvent),window.removeEventListener("popstate",CL_ModifyMenu),document.removeEventListener("mousewheel",InputPushWheelEvent),document.removeEventListener("visibilitychange",InputPushFocusEvent),document.removeEventListener("focus",InputPushFocusEvent),document.removeEventListener("blur",InputPushFocusEvent),document.removeEventListener("pointerlockchange",InputPushFocusEvent),e&&Q3e.canvas&&(Q3e.canvas.removeEventListener("mousemove",InputPushMouseEvent),Q3e.canvas.removeEventListener("mousedown",InputPushMouseEvent),Q3e.canvas.removeEventListener("mouseup",InputPushMouseEvent),GL.deleteContext(Q3e.webgl),Q3e.canvas.remove(),delete Q3e.canvas)}var INPUT={keystrings:{},firstClick:!0,IN_Init:IN_Init,GLimp_Shutdown:GLimp_Shutdown,GLimp_StartDriverAndSetMode:GLimp_StartDriverAndSetMode,SDL_WasInit:function(e){return 1},SDL_StartTextInput:SDL_StartTextInput,SDL_StopTextInput:SDL_StopTextInput,SDL_ShowCursor:SDL_ShowCursor,SDL_SetWindowGrab:SDL_SetWindowGrab,Com_MaxFPSChanged:Com_MaxFPSChanged,Sys_ConsoleInput:Sys_ConsoleInput};const MAX_MSGLEN=16384;function reverseLookup(t){var e=Object.keys(NET.lookup).filter(function(e){return NET.lookup[e][0]==t[0]&&NET.lookup[e][1]==t[1]&&NET.lookup[e][2]==t[2]&&NET.lookup[e][3]==t[3]});return e.length?e[0]:null}function NET_AdrToString(e){return 2==HEAPU32[e>>2]?stringToAddress("localhost"):4==HEAPU32[e>>2]?stringToAddress(reverseLookup(HEAPU8.slice(e+4,e+8))||HEAPU8[e+4]+"."+HEAPU8[e+5]+"."+HEAPU8[e+6]+"."+HEAPU8[e+7]):void 0}function Sys_SockaddrToString(){}function Sys_StringToAdr(e,t){let n=addressToString(e);return n.match(/localhost/i)?(HEAPU32[t>>2]=2,NET.lookup[n]=[127,0,0,1]):void 0===NET.lookup[n]?(256==NET.lookupCount1?(NET.lookupCount2++,NET.lookupCount1=1):NET.lookupCount1++,HEAPU32[t>>2]=4,e=n.match(/^([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)$/),NET.lookup[n]=e?[parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseInt(e[4])]:[10,0,NET.lookupCount2,NET.lookupCount1]):HEAPU32[t>>2]=4,HEAPU8[t+4]=NET.lookup[n][0],HEAPU8[t+5]=NET.lookup[n][1],HEAPU8[t+6]=NET.lookup[n][2],HEAPU8[t+7]=NET.lookup[n][3],!0}function Sys_StringToSockaddr(){}function Sys_SendPacket(e,t,n){let r=addressToString(n+10)||reverseLookup(HEAPU8.slice(n+4,n+8)),o=new Uint8Array(4+(r.length?r.length+2:4)+2+e);o[0]=0,o[1]=0,o[2]=0,r.length?(o[3]=3,o[4]=r.length+1,o.set(r.split("").map(e=>e.charCodeAt(0)),5),o[5+r.length+1]=HEAPU8[n+8],o[5+r.length+2]=HEAPU8[n+9]):(o[3]=1,o[4]=HEAPU8[n+4],o[5]=HEAPU8[n+5],o[6]=HEAPU8[n+6],o[7]=HEAPU8[n+7],o[8]=HEAPU8[n+8],o[9]=HEAPU8[n+9]),o.set(HEAPU8.slice(t,t+e),o.length-e),NET.socket1&&NET.socket1.readyState==WebSocket.OPEN&&3<=NET.socket1.fresh?NET.socket1.send(o):NET.socket1Queue.push(o),NET.socket2&&NET.socket2.readyState==WebSocket.OPEN&&3<=NET.socket2.fresh?NET.socket2.send(o):NET.socket2Queue.push(o)}function NET_Sleep(){var t=Cvar_VariableIntegerValue(stringToAddress("sv_running")),n=Cvar_VariableIntegerValue(stringToAddress("dedicated")),r=NET.queue.length;for(let e=0;e<r;e++){var o=NET.queue.shift(),i=NET.buffer,s=NET.buffer+512,a=NET.buffer+1024;HEAPU8.fill(0,i,i+512),HEAPU8.fill(0,s,s+512),HEAPU32[3+(s>>2)]=a,HEAPU32[4+(s>>2)]=MAX_MSGLEN,HEAPU32[5+(s>>2)]=8*MAX_MSGLEN,HEAPU32[6+(s>>2)]=o[2].length,HEAPU8.set(o[2],a),HEAPU32[i>>2]=4,HEAPU8[i+8]=o[1][1],HEAPU8[i+9]=o[1][0],"string"==typeof o[0]?Sys_StringToAdr(stringToAddress(o[0]),i):HEAPU8.set(o[0],i+4),(t||n?Com_RunAndTimeServerPacket:CL_PacketEvent)(i,s)}}function sendHeartbeat(e){e.readyState==WebSocket.OPEN?(e.fresh=5,e.send(Uint8Array.from([5,1,0,0]),{binary:!0})):e.readyState==WebSocket.CLOSED&&(NET.reconnect=!0,e==NET.socket1?NET.socket1=null:NET.socket2=null,NET_OpenIP())}function sendLegacyEmscriptenConnection(e,t){e.send(Uint8Array.from([255,255,255,255,"p".charCodeAt(0),"o".charCodeAt(0),"r".charCodeAt(0),"t".charCodeAt(0),(65280&t)>>8,255&t]))}function socketOpen(e){e.target.fresh=1,e.target.send(Uint8Array.from([5,1,0])),NET.heartbeat||(NET.heartbeat=setInterval(function(){sendHeartbeat(NET.socket1),NET.heartbeatTimeout=setTimeout(function(){sendHeartbeat(NET.socket2)},8e3)},1e4)),NET.reconnect&&sendLegacyEmscriptenConnection(e.target,NET.net_port)}function socketMessage(r){let o=new Uint8Array(r.data);switch(r.target.fresh){case 1:if(2!=o.length)throw new Error("wtf? this socket no worky");if(0!=o[1])throw new Error("this socket requires a password, dude");r.target.send(Uint8Array.from([5,3,0,1,0,0,0,0,(65280&NET.net_port)>>8,255&NET.net_port])),r.target.fresh=2;break;case 2:if(o.length<5)throw new Error("denied, can't have ports");if(1!=o[3])throw new Error("relay address is not IPV4");sendLegacyEmscriptenConnection(r.target,NET.net_port),r.target.fresh=3;break;case 3:if(10==o.length){r.target.fresh=4;break}case 4:case 5:if(2==o.length||10==o.length)return void(r.target.fresh=4);let e,t,n;if(1==o[3])e=o.slice(4,8),t=o.slice(8,10),n=Array.from(o.slice(10));else{if(3!=o[3])throw new Error("don' know what to do mate");e=Array.from(o.slice(5,5+o[4])).map(function(e){return String.fromCharCode(e)}).join(""),t=o.slice(5+o[4],5+o[4]+2),n=Array.from(o.slice(5+e.length+2))}NET.queue.push([e,t,n])}}function socketError(e){NET.reconnect=!0,e.target==NET.socket1&&(NET.socket1=NULL),e.target==NET.socket2&&(NET.socket2=NULL)}function NET_OpenIP(){var e;NET.net_port=addressToString(Cvar_VariableString(stringToAddress("net_port"))),NET.net_socksServer=addressToString(Cvar_VariableString(stringToAddress("net_socksServer"))),NET.net_socksPort=addressToString(Cvar_VariableString(stringToAddress("net_socksPort"))),NET.buffer||(NET.buffer=malloc(MAX_MSGLEN+8+24+1024)),NET.queue||(NET.queue=[]),"file:"!=window.location.protocol&&(e="ws"+(5<window.location.protocol.length?"s":"")+"://"+NET.net_socksServer+":"+NET.net_socksPort,NET.socket1||(NET.socket1=new WebSocket(e),NET.socket1.binaryType="arraybuffer",NET.socket1.addEventListener("open",socketOpen,!1),NET.socket1.addEventListener("message",socketMessage,!1),NET.socket1.addEventListener("error",socketError,!1)),NET.socket2||(NET.socket2=new WebSocket(e),NET.socket2.binaryType="arraybuffer",NET.socket2.addEventListener("open",socketOpen,!1),NET.socket2.addEventListener("message",socketMessage,!1),NET.socket2.addEventListener("error",socketError,!1)))}function NET_Shutdown(){NET.heartbeat&&clearInterval(NET.heartbeat),NET.heartbeatTimeout&&clearTimeout(NET.heartbeatTimeout),NET.socket1&&(NET.socket1.removeEventListener("open",socketOpen),NET.socket1.removeEventListener("message",socketMessage),NET.socket1.removeEventListener("close",socketError),NET.socket1.close(),NET.socket1=null),NET.socket2&&(NET.socket2.removeEventListener("open",socketOpen),NET.socket2.removeEventListener("message",socketMessage),NET.socket2.removeEventListener("close",socketError),NET.socket2.close(),NET.socket2=null)}function Sys_IsLANAddress(){}function Sys_Offline(){}function Sys_NET_MulticastLocal(e,t,n){window.serverWorker.postMessage(["net",e,Uint8Array.from(HEAP8.slice(n,n+t))])}function Com_DL_HeaderCallback(e,t){return t&&(200<=t.status&&t.status<300||304===t.status)?Promise.resolve(t.arrayBuffer()):(Sys_FileReady(stringToAddress(e),null),t.body.getReader().cancel(),Promise.resolve())}function Com_DL_Begin(t,e){return AbortController&&!NET.controller&&(NET.controller=new AbortController),e+=(e.includes("?")?"&":"?")+"time="+Q3e.cacheBuster,fetch(e,{mode:"cors",responseType:"arraybuffer",credentials:"omit",signal:NET.controller?NET.controller.signal:null}).catch(function(e){}).then(function(e){return Com_DL_HeaderCallback(t,e)}).catch(function(e){})}function Com_DL_Perform(e,t,n){var r;NET.downloadCount--,n&&(t.includes("version.json")&&(Q3e.cacheBuster=Date.parse(JSON.parse(Array.from(new Uint8Array(n)).map(e=>String.fromCharCode(e)).join(""))[0])),e.endsWith("/")?(r=e+"."+Math.round(4294967295*Math.random()).toString(16)+".tmp",FS_CreatePath(stringToAddress(e)),FS.virtual[r]={timestamp:new Date,mode:33206,contents:new Uint8Array(n)},Sys_FileReady(stringToAddress(t),stringToAddress(r))):(FS_CreatePath(stringToAddress(e)),FS.virtual[e]={timestamp:new Date,mode:33206,contents:new Uint8Array(n)},writeStore(FS.virtual[e],e),Sys_FileReady(stringToAddress(t),stringToAddress(e))))}function CL_Download(e,t,n){if(FS.database||openDatabase(),5<NET.downloadCount)return!1;let r=addressToString(Cvar_VariableString(stringToAddress("cl_dlURL")));var o=addressToString(FS_GetCurrentGameDir());let i=addressToString(t),s=i;"/"==(s=(s="/"==s[0]?s.substring(1):s).startsWith(o)?s.substring(o.length):s)[0]&&(s=s.substring(1));let a;(a=r.includes("%1")?r.replace("%1",s.replace(/\//gi,"%2F")):r+"/"+s).includes(".googleapis.com")&&(i.endsWith("/")?a="https://www.googleapis.com/storage/v1/b/"+a.match(/\/b\/(.*?)\/o\//)[1]+"/o/?includeTrailingDelimiter=true&maxResults=100&delimiter=%2f&prefix="+a.match(/\/o\/(.*)/)[1]:a.includes("?")||(a+="?alt=media"));try{NET.downloadCount++,readStore(i).then(function(e){return!e||16895==e.mode||e.timestamp.getTime()<Q3e.cacheBuster?Com_DL_Begin(s,a):Promise.resolve(e.contents)}).then(function(e){Com_DL_Perform(i,s,e)})}catch(e){}if(i.includes(o))return!0;throw new Error("something wrong")}var NET={reconnect:!1,socket1Queue:[],socket2Queue:[],lookup:{},lookupCount1:1,lookupCount2:127,downloadCount:0,controller:null,NET_AdrToString:NET_AdrToString,Sys_Offline:Sys_Offline,Sys_SockaddrToString:Sys_SockaddrToString,Sys_StringToSockaddr:Sys_StringToSockaddr,NET_Sleep:NET_Sleep,NET_OpenIP:NET_OpenIP,Sys_StringToAdr:Sys_StringToAdr,Sys_SendPacket:Sys_SendPacket,Sys_IsLANAddress:Sys_IsLANAddress,Sys_NET_MulticastLocal:Sys_NET_MulticastLocal,CL_Download:CL_Download};function Com_RealTime(e){let t=new Date,n=n.now()/1e3;return HEAP32[5+(tm>>2)]=t.getFullYear()-1900,HEAP32[4+(tm>>2)]=t.getMonth(),HEAP32[3+(tm>>2)]=t.getDate(),HEAP32[2+(tm>>2)]=n/60/60%24,HEAP32[1+(tm>>2)]=n/60%60,HEAP32[tm>>2]=n%60,n}var DATE={mktime:function(e){return new Date(HEAP32[5+(e>>2)]+1900,HEAP32[4+(e>>2)],HEAP32[3+(e>>2)],HEAP32[2+(e>>2)],HEAP32[1+(e>>2)],HEAP32[e>>2]).getTime()/1e3},asctime:function(){return stringToAddress((new Date).toLocaleString())},time:function(){},localtime:function(e){var t=Q3e.sharedMemory+Q3e.sharedCounter;HEAP32[t+4>>2]=floor(e/60),HEAP32[t+4>>2]=floor(e/60/60),HEAP32[t+4>>2]=floor(e/60/60)},ctime:function(e){return stringToAddress(new Date(e).toString())},Com_RealTime:Com_RealTime},STD={__assert_fail:console.assert,longjmp:function(e,t){throw new Error("longjmp",e,t)},setjmp:function(e){}},MATHS={srand:function(){},rand:Math.random,exp2:function(e){return Math.pow(2,e)},exp2f:function(e){return Math.pow(2,e)}};let maths=Object.getOwnPropertyNames(Math);for(let e=0;e<maths.length;e++)MATHS[maths[e]+"f"]=Math[maths[e]],MATHS[maths[e]]=Math[maths[e]];function startProgram(e){if(!e)throw new Error("no program!");Q3e.program=e,Q3e.instance=e.instance,Q3e.exports=e.instance.exports;var t=Object.keys(Q3e.exports);for(let e=0;e<t.length;e++)window[t[e]]=Q3e.exports[t[e]];return void 0===window.Z_Malloc&&(window.Z_Malloc=window.Z_MallocDebug),Object.assign(window,Q3e.exports),setTimeout(function(){try{Q3e.sharedMemory=malloc(1048576),Q3e.sharedCounter=0,Q3e.exited=!1;var e=getQueryCommands();RunGame(e.length,stringsToMemory(e)),INPUT.fpsUnfocused=Cvar_VariableIntegerValue(stringToAddress("com_maxfpsUnfocused")),INPUT.fps=Cvar_VariableIntegerValue(stringToAddress("com_maxfps")),Q3e.frameInterval=setInterval(Sys_Frame,1e3/(HEAP32[gw_active>>2]?INPUT.fps:INPUT.fpsUnfocused))}catch(e){throw console.log(e),Sys_Exit(1),e}},13),!0}function instantiateWasm(e){var t={env:Q3e,SYS:SYS,GL:EMGL,MATH:MATHS,FS:FS,NET:NET,DATE:DATE,INPUT:INPUT,STD:STD,SND:SND};if(!e)throw new Error("Couldn't find wasm!");Object.assign(Q3e,t);for(let e=0;e<Object.keys(t).length;e++)Object.assign(Q3e.env,Object.values(t)[e]);return Q3e.table=Q3e.__indirect_function_table=new WebAssembly.Table({initial:2048,element:"anyfunc"}),Q3e.memory=new WebAssembly.Memory({initial:2048}),updateGlobalBufferAndViews(Q3e.memory.buffer),WebAssembly.instantiate(e,Q3e)}function _base64ToArrayBuffer(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),o=0;o<n;o++)r[o]=t.charCodeAt(o);return r}function init(){if((Q3e.imports=Q3e).cacheBuster=Date.now(),readAll(),void 0!==window.preFS){var t=Object.keys(window.preFS);for(let e=0;e<t.length;e++)FS.virtual[t[e]]={timestamp:new Date,mode:33206,contents:_base64ToArrayBuffer(window.preFS[t[e]])};if(void 0!==FS.virtual["quake3e.wasm"])return Promise.resolve(FS.virtual["quake3e.wasm"].contents)}return fetch("./quake3e_mv.wasm?time="+Q3e.cacheBuster).catch(function(e){}).then(function(e){if(!e||404==e.status)return fetch("./quake3e_slim.wasm?time="+Q3e.cacheBuster)}).catch(function(e){}).then(function(e){if(!e||404==e.status)return fetch("./quake3e.wasm?time="+Q3e.cacheBuster)}).catch(function(e){}).then(function(e){if(e&&200==e.status)return e.arrayBuffer()})}window.addEventListener("load",function(){void 0===Q3e.imports&&init().then(instantiateWasm).then(startProgram)},!1);var SND={channels:2,nextPlayTime:0,bufferingDelay:.05,SNDDMA_Init:SNDDMA_Init,SNDDMA_Shutdown:SNDDMA_Shutdown,SNDDMA_BeginPainting:SNDDMA_BeginPainting,SNDDMA_Submit:SNDDMA_Submit,SNDDMA_GetDMAPos:SNDDMA_GetDMAPos};const smoothingInterval=.02,beepLengthInSeconds=.5,beeps=[220,440,880];let buffer_pos=0;function SNDDMA_AudioCallback_Test(e,t){let n=Math.floor(SND.audioContext.currentTime*(HEAPU32[4+(dma>>2)]/8));65536<=n&&(buffer_pos=n=0),console.log(HEAPU32[HEAPU32[7+(dma>>2)]+n>>2])}function SNDDMA_Shutdown(){SND.interval&&clearInterval(SND.interval),SND.oscillator.disconnect(SND.gainNode)}function SNDDMA_BeginPainting(){}function SNDDMA_Submit(){}function SNDDMA_GetDMAPos(){return HEAPU32[s_soundStarted>>2]?samples=HEAPU32[1+(dma>>2)]?buffer_pos%HEAPU32[1+(dma>>2)]:0:0}function SNDDMA_Init(){if(SND.audioOutput=new Audio,INPUT.firstClick)return 0;if(SND.audioContext||("undefined"!=typeof AudioContext?SND.audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(SND.audioContext=new webkitAudioContext)),!SND.audioContext)throw new Error("Web Audio API is not available!");SND.nextPlayTime=0;var e=stringToAddress("s_sdlChannels");return Cvar_CheckRange(Cvar_Get(e,stringToAddress("2"),CVAR_ARCHIVE_ND|CVAR_LATCH),stringToAddress("1"),stringToAddress("2"),CV_INTEGER),SND.channels=Cvar_VariableIntegerValue(e),Cvar_CheckRange(Cvar_Get(stringToAddress("s_sdlBits"),stringToAddress("16"),CVAR_ARCHIVE_ND|CVAR_LATCH),stringToAddress("8"),stringToAddress("16"),CV_INTEGER),SND.gainNode=SND.audioContext.createGain(),SND.gainNode.connect(SND.audioContext.destination),SND.gainNode.gain.setValueAtTime(0,SND.audioContext.currentTime),SND.oscillator=SND.audioContext.createOscillator(),SND.oscillator.frequency.value=2*Math.random()-1,SND.interval||(SND.interval=setInterval(SNDDMA_AudioCallback_Test.bind(null,SND.gainNode.gain,SND.oscillator),50)),SND.oscillator.connect(SND.gainNode),SND.oscillator.start(),HEAPU32[dma>>2]=SND.channels,HEAPU32[1+(dma>>2)]=SND.audioContext.sampleRate*(smoothingInterval+1e3/INPUT.fps),HEAPU32[2+(dma>>2)]=HEAPU32[1+(dma>>2)]/SND.channels,HEAPU32[3+(dma>>2)]=1,HEAPU32[4+(dma>>2)]=16,HEAPU32[5+(dma>>2)]=1,HEAPU32[6+(dma>>2)]=44100,HEAPU32[7+(dma>>2)]=dma_buffer2,HEAPU32[8+(dma>>2)]=stringToAddress(AudioContext.toString()),HEAPU32[s_soundStarted>>2]=1,HEAPU32[s_soundMuted>>2]=0,S_Base_SoundInfo(),1}!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("nipplejs",[],t):"object"==typeof exports?exports.nipplejs=t():e.nipplejs=t()}(window,function(){return n=[function(e,t,n){"use strict";n.r(t);function m(e,t){var n=t.x-e.x,t=t.y-e.y;return Math.sqrt(n*n+t*t)}function p(e){return e*(Math.PI/180)}function o(e,t,n){for(var r,o=t.split(/[ ,]+/g),i=0;i<o.length;i+=1)r=o[i],e.addEventListener?e.addEventListener(r,n,!1):e.attachEvent&&e.attachEvent(r,n)}function r(e,t,n){for(var r,o=t.split(/[ ,]+/g),i=0;i<o.length;i+=1)r=o[i],e.removeEventListener?e.removeEventListener(r,n):e.detachEvent&&e.detachEvent(r,n)}function i(e){return e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e}function h(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}}function _(e,t){t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function s(e,t,n){var r,o=l(e);for(r in o)if(o.hasOwnProperty(r))if("string"==typeof t)o[r]=t+" "+n;else{for(var i="",s=0,a=t.length;s<a;s+=1)i+=t[s]+" "+n+", ";o[r]=i.slice(0,-2)}return o}function l(t){var n={};return n[t]="",["webkit","Moz","o"].forEach(function(e){n[e+t.charAt(0).toUpperCase()+t.slice(1)]=""}),n}function a(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function c(e,t){if(e.length)for(var n=0,r=e.length;n<r;n+=1)t(e[n]);else t(e)}var u,n=!!("ontouchstart"in window),d=!!window.PointerEvent,f=!!window.MSPointerEvent,g={start:"mousedown",move:"mousemove",end:"mouseup"},E={};function y(){}d?u={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:f?u={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:n?(u={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},E=g):u=g,y.prototype.on=function(e,t){var n,r=e.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var o=0;o<r.length;o+=1)n=r[o],this._handlers_[n]=this._handlers_[n]||[],this._handlers_[n].push(t);return this},y.prototype.off=function(e,t){return this._handlers_=this._handlers_||{},void 0===e?this._handlers_={}:void 0===t?this._handlers_[e]=null:this._handlers_[e]&&0<=this._handlers_[e].indexOf(t)&&this._handlers_[e].splice(this._handlers_[e].indexOf(t),1),this},y.prototype.trigger=function(e,t){var n,r=this,o=e.split(/[ ,]+/g);r._handlers_=r._handlers_||{};for(var i=0;i<o.length;i+=1)n=o[i],r._handlers_[n]&&r._handlers_[n].length&&r._handlers_[n].forEach(function(e){e.call(r,{type:n,target:r},t)})},y.prototype.config=function(e){this.options=this.defaults||{},e&&(this.options=function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?r[n]=t[n]:e.hasOwnProperty(n)&&(r[n]=e[n]);return r}(this.options,e))},y.prototype.bindEvt=function(e,t){var n=this;return n._domHandlers_=n._domHandlers_||{},n._domHandlers_[t]=function(){"function"==typeof n["on"+t]?n["on"+t].apply(n,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},o(e,u[t],n._domHandlers_[t]),E[t]&&o(e,E[t],n._domHandlers_[t]),n},y.prototype.unbindEvt=function(e,t){return this._domHandlers_=this._domHandlers_||{},r(e,u[t],this._domHandlers_[t]),E[t]&&r(e,E[t],this._domHandlers_[t]),delete this._domHandlers_[t],this};d=y;function S(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=S.id,S.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}S.prototype=new d,(S.constructor=S).id=0,S.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},S.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=function(){var e,t=l("borderRadius");for(e in t)t.hasOwnProperty(e)&&(t[e]="50%");return t}(),e=s("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},a(n.el,e),a(n.back,t),a(n.front,t),this.applyStyles(n),this},S.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var n in e[t])this.ui[t].style[n]=e[t][n];return this},S.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},S.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},S.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},S.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout(function(){t.ui.el.style.opacity=1},0),t.showTimeout=setTimeout(function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)},t.options.fadeTime)),t},S.prototype.hide=function(t){var n=this;return n.options.dataOnly||(n.ui.el.style.opacity=n.options.restOpacity,clearTimeout(n.removeTimeout),clearTimeout(n.showTimeout),clearTimeout(n.restTimeout),n.removeTimeout=setTimeout(function(){var e="dynamic"===n.options.mode?"none":"block";n.ui.el.style.display=e,"function"==typeof t&&t.call(n),n.trigger("hidden",n.instance)},n.options.fadeTime),n.options.restJoystick&&n.setPosition(t,{x:0,y:0})),n},S.prototype.setPosition=function(e,t){var n=this,t=(n.frontPosition={x:t.x,y:t.y},n.options.fadeTime+"ms"),r={},t=(r.front=s("transition",["top","left"],t),{front:{}});t.front={left:n.frontPosition.x+"px",top:n.frontPosition.y+"px"},n.applyStyles(r),n.applyStyles(t),n.restTimeout=setTimeout(function(){"function"==typeof e&&e.call(n),n.restCallback()},n.options.fadeTime)},S.prototype.restCallback=function(){var e={};e.front=s("transition","none",""),this.applyStyles(e),this.trigger("rested",this.instance)},S.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},S.prototype.computeDirection=function(e){var t,n,r,o=e.angle.radian,i=Math.PI/4,s=Math.PI/2;if(i<o&&o<3*i&&!e.lockX?t="up":-i<o&&o<=i&&!e.lockY?t="left":3*-i<o&&o<=-i&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(n=-s<o&&o<s?"left":"right"),e.lockX||(r=0<o?"up":"down"),e.force>this.options.threshold){var a,l={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(l[a]=this.direction[a]);var c={};for(a in this.direction={x:n,y:r,angle:t},e.direction=this.direction,l)l[a]===this.direction[a]&&(c[a]=!0);if(c.x&&c.y&&c.angle)return e;c.x&&c.y||this.trigger("plain",e),c.x||this.trigger("plain:"+n,e),c.y||this.trigger("plain:"+r,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var v=S;function L(e,t){return this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=e,this.id=L.id,L.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,dynamicPage:!1},this.config(t),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}L.prototype=new d,(L.constructor=L).id=0,L.prototype.prepareNipples=function(){var r=this.nipples;r.on=this.on.bind(this),r.off=this.off.bind(this),r.options=this.options,r.destroy=this.destroy.bind(this),r.ids=this.ids,r.id=this.id,r.processOnMove=this.processOnMove.bind(this),r.processOnEnd=this.processOnEnd.bind(this),r.get=function(e){if(void 0===e)return r[0];for(var t=0,n=r.length;t<n;t+=1)if(r[t].identifier===e)return r[t];return!1}},L.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},L.prototype.begin=function(){var e=this.options;"static"===e.mode&&((e=this.createNipple(e.position,this.manager.getIdentifier())).add(),this.idles.push(e))},L.prototype.createNipple=function(e,t){var n,r=h(),o={},i=this.options,s=(e.x&&e.y?o={x:e.x-(r.x+this.box.left),y:e.y-(r.y+this.box.top)}:(e.top||e.right||e.bottom||e.left)&&((s=document.createElement("DIV")).style.display="hidden",s.style.top=e.top,s.style.right=e.right,s.style.bottom=e.bottom,s.style.left=e.left,s.style.position="absolute",i.zone.appendChild(s),n=s.getBoundingClientRect(),i.zone.removeChild(s),o=e,e={x:n.left+r.x,y:n.top+r.y}),new v(this,{color:i.color,size:i.size,threshold:i.threshold,fadeTime:i.fadeTime,dataOnly:i.dataOnly,restJoystick:i.restJoystick,restOpacity:i.restOpacity,mode:i.mode,identifier:t,position:e,zone:i.zone,frontPosition:{x:0,y:0}}));return i.dataOnly||(_(s.ui.el,o),_(s.ui.front,s.frontPosition)),this.nipples.push(s),this.trigger("added "+s.identifier+":added",s),this.manager.trigger("added "+s.identifier+":added",s),this.bindNipple(s),s},L.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},L.prototype.bindNipple=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,r.trigger(n,t)}var n,r=this;e.on("destroyed",r.onDestroyed.bind(r)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},L.prototype.pressureFn=function(t,n,e){var r=this,o=0;clearInterval(r.pressureIntervals[e]),r.pressureIntervals[e]=setInterval(function(){var e=t.force||t.pressure||t.webkitForce||0;e!==o&&(n.trigger("pressure",e),r.trigger("pressure "+n.identifier+":pressure",e),o=e)}.bind(r),100)},L.prototype.onstart=function(n){var r=this,t=r.options,o=n;return n=i(n),r.updateBox(),c(n,function(e){r.actives.length<t.maxNumberOfNipples?r.processOnStart(e):o.type.match(/^touch/)&&(Object.keys(r.manager.ids).forEach(function(t){var e;Object.values(o.touches).findIndex(function(e){return e.identifier===t})<0&&((e=[n[0]]).identifier=t,r.processOnEnd(e))}),r.actives.length<t.maxNumberOfNipples&&r.processOnStart(e))}),r.manager.bindDocument(),!1},L.prototype.processOnStart=function(t){function e(e){e.trigger("start",e),n.trigger("start "+e.id+":start",e),e.show(),0<i&&n.pressureFn(t,e,e.identifier),n.processOnMove(t)}var n=this,r=n.options,o=n.manager.getIdentifier(t),i=t.force||t.pressure||t.webkitForce||0,s={x:t.pageX,y:t.pageY},a=n.getOrCreate(o,s);a.identifier!==o&&n.manager.removeIdentifier(a.identifier),a.identifier=o;if(0<=(o=n.idles.indexOf(a))&&n.idles.splice(o,1),n.actives.push(a),n.ids.push(a.identifier),"semi"!==r.mode)e(a);else{if(!(m(s,a.position)<=r.catchDistance))return a.destroy(),void n.processOnStart(t);e(a)}return a},L.prototype.getOrCreate=function(e,t){var n,r=this.options;return/(semi|static)/.test(r.mode)?(n=this.idles[0])?(this.idles.splice(0,1),n):"semi"===r.mode?this.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):this.createNipple(t,e)},L.prototype.processOnMove=function(e){var t=this.options,n=this.manager.getIdentifier(e),r=this.nipples.get(n);if(o=e,isNaN(o.buttons)?0!==o.pressure:0!==o.buttons){if(!r)return console.error("Found zombie joystick with ID "+n),void this.manager.removeIdentifier(n);t.dynamicPage&&(o=h(),i=r.el.getBoundingClientRect(),r.position={x:o.x+i.left,y:o.y+i.top}),r.identifier=n;var o=r.options.size/2,i={x:e.pageX,y:e.pageY};t.lockX&&(i.y=r.position.y),t.lockY&&(i.x=r.position.x);var s,n=m(i,r.position),a=(a=i,l=r.position,c=l.x-a.x,l=l.y-a.y,Math.atan2(l,c)*(180/Math.PI)),l=p(a),c=n/o,u={distance:n,position:i},d=(o<n&&(d=r.position,f=n=o,s={x:0,y:0},g=p(a),s.x=d.x-f*Math.cos(g),s.y=d.y-f*Math.sin(g),i=s),i.x-r.position.x),f=i.y-r.position.y,g=(r.frontPosition={x:d,y:f},t.dataOnly||_(r.ui.front,r.frontPosition),{identifier:r.identifier,position:i,force:c,pressure:e.force||e.pressure||e.webkitForce||0,distance:n,angle:{radian:l,degree:a},vector:{x:d/o,y:-f/o},raw:u,instance:r,lockX:t.lockX,lockY:t.lockY});(g=r.computeDirection(g)).angle={radian:p(180-a),degree:180-a},r.trigger("move",g),this.trigger("move "+r.id+":move",g)}else this.processOnEnd(e)},L.prototype.processOnEnd=function(e){var t=this,n=t.options,e=t.manager.getIdentifier(e),r=t.nipples.get(e),e=t.manager.removeIdentifier(r.identifier);r&&(n.dataOnly||r.hide(function(){"dynamic"===n.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())}),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),0<=t.ids.indexOf(r.identifier)&&t.ids.splice(t.ids.indexOf(r.identifier),1),0<=t.actives.indexOf(r)&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(n.mode)?t.idles.push(r):0<=t.nipples.indexOf(r)&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(n.mode)&&(t.manager.ids[e.id]=e.identifier))},L.prototype.onDestroyed=function(e,t){0<=this.nipples.indexOf(t)&&this.nipples.splice(this.nipples.indexOf(t),1),0<=this.actives.indexOf(t)&&this.actives.splice(this.actives.indexOf(t),1),0<=this.idles.indexOf(t)&&this.idles.splice(this.idles.indexOf(t),1),0<=this.ids.indexOf(t.identifier)&&this.ids.splice(this.ids.indexOf(t.identifier),1),this.manager.removeIdentifier(t.identifier),this.manager.unbindDocument()},L.prototype.destroy=function(){for(var e in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(e){e.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(e)&&clearInterval(this.pressureIntervals[e]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var b=L;function x(e){var t,r=this;return r.ids={},r.index=0,r.collections=[],r.config(e),r.prepareCollections(),o(window,"resize",function(e){clearTimeout(t),t=setTimeout(function(){var t,n=h();r.collections.forEach(function(e){e.forEach(function(e){t=e.el.getBoundingClientRect(),e.position={x:n.x+t.left,y:n.y+t.top}})})},100)}),r.collections}x.prototype=new d,(x.constructor=x).prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var n;return e.collections.every(function(e){return!(n=e.get(t))}),n}},x.prototype.create=function(e){return this.createCollection(e)},x.prototype.createCollection=function(e){e=new b(this,e);return this.bindCollection(e),this.collections.push(e),e},x.prototype.bindCollection=function(e){function t(e,t){n=e.type+" "+t.id+":"+e.type,r.trigger(n,t)}var n,r=this;e.on("destroyed",r.onDestroyed.bind(r)),e.on("shown hidden rested dir plain",t),e.on("dir:up dir:right dir:down dir:left",t),e.on("plain:up plain:right plain:down plain:left",t)},x.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},x.prototype.unbindDocument=function(e){Object.keys(this.ids).length&&!0!==e||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},x.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},x.prototype.removeIdentifier=function(e){var t,n={};for(t in this.ids)if(this.ids[t]===e){n.id=t,n.identifier=this.ids[t],delete this.ids[t];break}return n},x.prototype.onmove=function(e){return this.onAny("move",e),!1},x.prototype.onend=function(e){return this.onAny("end",e),!1},x.prototype.oncancel=function(e){return this.onAny("end",e),!1},x.prototype.onAny=function(e,t){var n,r=this,o="processOn"+e.charAt(0).toUpperCase()+e.slice(1);return t=i(t),c(t,function(e){n=r.getIdentifier(e),c(r.collections,function(e,t,n){0<=n.ids.indexOf(t)&&(n[o](e),e._found_=!0)}.bind(null,e,n)),e._found_||r.removeIdentifier(n)}),!1},x.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(e){e.destroy()}),this.off()},x.prototype.onDestroyed=function(e,t){if(this.collections.indexOf(t)<0)return!1;this.collections.splice(this.collections.indexOf(t),1)};var A=new x;t.default={create:function(e){return A.create(e)},factory:A}}],r={},o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0).default;function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});